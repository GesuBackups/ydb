syntax = "proto3";

package yandex.cloud.priv.vdi.v1.api;

import "yandex/cloud/priv/sensitive.proto";
import "yandex/cloud/api/operation.proto";
import "yandex/cloud/priv/operation/operation.proto";
import "yandex/cloud/priv/validation.proto";
import "yandex/cloud/priv/vdi/v1/api/desktop.proto";
import "yandex/cloud/priv/vdi/v1/api/user.proto";

option go_package = "a.yandex-team.ru/cloud/bitbucket/private-api/yandex/cloud/priv/vdi/v1/api;vdi";
option java_outer_classname = "PADS";

service DesktopService {

    rpc Get (GetDesktopRequest) returns (Desktop);

    rpc GetRdpFile (GetRdpFileRequest) returns (RdpFileResponse);

    rpc List (ListDesktopsRequest) returns (ListDesktopsResponse);

    rpc ListOperations (ListDesktopOperationsRequest) returns (ListDesktopOperationsResponse);

    rpc Create (CreateDesktopRequest) returns (operation.Operation) {
        option (yandex.cloud.api.operation) = {
            metadata: "CreateDesktopMetadata"
            response: "Desktop"
        };
    };

    rpc Delete (DeleteDesktopRequest) returns (operation.Operation) {
        option (yandex.cloud.api.operation) = {
            metadata: "DeleteDesktopMetadata"
            response: "google.protobuf.Empty"
        };
    }

    rpc ResetPassword(ResetPasswordRequest) returns (ResetPasswordResponse);

    rpc Restart(RestartRequest) returns (operation.Operation) {
        option (yandex.cloud.api.operation) = {
            metadata: "RestartDesktopMetadata"
            response: "google.protobuf.Empty"
        };
    }
}

message GetDesktopRequest {
    string desktop_id = 1 [(required) = true, (length) = "<=50"];
}

message GetRdpFileRequest {
    string desktop_id = 1 [(required) = true, (length) = "<=50"];
    User user = 2 [(required) = false];
}

message RdpFileResponse {
    map<string, string> headers = 1;
    string content = 2;
}

message ListDesktopsRequest {
    string folder_id = 2 [(required) = true, (length) = "<=50"];

    int64 page_size = 21 [(value) = "0-1000"];
    string page_token = 22 [(length) = "<=100"];
    string filter = 23 [(length) = "<=1000"];
    string order_by = 24 [(length) = "<=100"];
}

message ListDesktopsResponse {
    repeated Desktop desktops = 1;

    string next_page_token = 22;
}

message ListDesktopOperationsRequest {
    string desktop_id = 1 [(required) = true, (length) = "<=50"];

    int64 page_size = 21 [(value) = "0-1000"];
    string page_token = 22 [(length) = "<=100"];
    string filter = 23 [(length) = "<=1000"];
}

message ListDesktopOperationsResponse {
    repeated operation.Operation operations = 1;

    string next_page_token = 22;
}

message CreateDesktopRequest {
    string desktop_group_id = 3 [(required) = true, (length) = "<=50"];
    repeated User users = 23 [(size) = ">0"];
}

message CreateDesktopMetadata {
    string desktop_id = 1;
}

message DeleteDesktopRequest {
    string desktop_id = 1 [(required) = true, (length) = "<=50"];
}

message DeleteDesktopMetadata {
    string desktop_id = 1;
}

message ResetPasswordRequest {
    string desktop_id = 1 [(required) = true, (length) = "<=50"];
    User user = 2 [(required) = true];
}

message ResetPasswordResponse {
    string password = 1 [(sensitive) = true, (sensitive_type) = SENSITIVE_REMOVE];
}

message RestartRequest {
    string desktop_id = 1 [(required) = true, (length) = "<=50"];
}

message RestartDesktopMetadata {
    string desktop_id = 1 [(required) = true, (length) = "<=50"];
}
