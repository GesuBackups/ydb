syntax = "proto3";

package yandex.cloud.priv.resourcemanager.v1.transitional;

import "google/api/annotations.proto";
import "yandex/cloud/api/operation.proto";
import "yandex/cloud/api/tools/options.proto";
import "yandex/cloud/priv/operation/operation.proto";
import "yandex/cloud/priv/resourcemanager/v1/cloud.proto";
import "yandex/cloud/priv/validation.proto";

option go_package = "a.yandex-team.ru/cloud/bitbucket/private-api/yandex/cloud/priv/resourcemanager/v1/transitional;iam";
option java_outer_classname = "PTCS";

service CloudService {
  // TODO no pagination
  rpc List (ListCloudsRequest) returns (ListCloudsResponse) {
    option (google.api.http) = { get: "/yrm/v1/clouds" };
  }

  // TODO public
  rpc Create (CreateCloudInternalRequest) returns (yandex.cloud.priv.resourcemanager.v1.Cloud) {
    option (google.api.http) = { post: "/yrm/v1/cloud" body: "*" };
  }

  // TODO ?
  rpc CreateCloud (CreateCloudRequest) returns (yandex.cloud.priv.resourcemanager.v1.Cloud) {
    option (google.api.http) = { post: "/yrm/v1/cloud/create" body: "*" };
    option (yandex.cloud.api.tools.method).lint_skip.contains_resource_name = true;
  }

  rpc GetStatus (GetCloudStatusRequest) returns (GetCloudStatusResponse) {
    option (google.api.http) = { get: "/yrm/v1/cloud/{cloud_id}/status" };
  }

  rpc SetStatus (SetCloudStatusRequest) returns (SetCloudStatusResponse) {
    option (google.api.http) = { post: "/yrm/v1/cloud/{cloud_id}/status" body: "*" };
  }

  rpc BlockClouds (BlockCloudsRequest) returns (operation.Operation) {
    option (google.api.http) = {post: "/yrm/v1/blockClouds" body: "*"};
    option (yandex.cloud.api.operation) = {
      metadata: "BlockCloudsMetadata"
      response: "google.protobuf.Empty"
    };
    option (yandex.cloud.api.tools.method).lint_skip.contains_resource_name = true;
  }

  rpc UnblockClouds (UnblockCloudsRequest) returns (operation.Operation) {
    option (google.api.http) = {post: "/yrm/v1/unblockClouds" body: "*"};
    option (yandex.cloud.api.operation) = {
      metadata: "BlockCloudsMetadata"
      response: "google.protobuf.Empty"
    };
    option (yandex.cloud.api.tools.method).lint_skip.contains_resource_name = true;
  }
}

message ListCloudsRequest {
  string id = 1; // TODO repeated ids
  string name = 2;
}

message ListCloudsResponse {
  repeated yandex.cloud.priv.resourcemanager.v1.Cloud result = 1;
}

message CreateCloudInternalRequest {
  string name = 1;
  string description = 2;
  string owner_login = 3;
}

message CreateCloudRequest {
  string trial = 1;
}

message GetCloudStatusRequest {
  string cloud_id = 1;
}

message GetCloudStatusResponse {
  string status = 1;
}

message SetCloudStatusRequest {
  string cloud_id = 1;
  string status = 2;
}

message SetCloudStatusResponse {
  string result = 1;
}

message BlockCloudsRequest {
  enum Reason {
    REASON_UNSPECIFIED = 0;
    BILLING = 1;
  }

  repeated string cloud_ids = 1 [(size) = "1-1000", (length) = "1-50"];
  Reason reason = 2;
}

message UnblockCloudsRequest {
  enum Reason {
    REASON_UNSPECIFIED = 0;
    BILLING = 1;
  }

  repeated string cloud_ids = 1 [(size) = "1-1000", (length) = "1-50"];
  Reason reason = 2;
}

message BlockCloudsMetadata {
  repeated string cloud_ids = 1;
}
