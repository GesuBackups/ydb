syntax = "proto3";

package yandex.cloud.priv.mdb.sqlserver.v1alpha.config;

import "google/protobuf/wrappers.proto";
import "yandex/cloud/priv/validation.proto";

option go_package = "a.yandex-team.ru/cloud/bitbucket/private-api/yandex/cloud/priv/mdb/sqlserver/v1alpha/config;sqlserver";

// Options and structure of `SQLServerConfig2016sp2` reflects sqlserver 2016 sp2 configuration file
message SQLServerConfig2016sp2 {
  //sp_configure option for contolling degree of parallelism. https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/configure-the-max-degree-of-parallelism-server-configuration-option?view=sql-server-ver15
  google.protobuf.Int64Value max_degree_of_parallelism  = 1 [(value) = "1-99"];

  //sp_configure option for controling how heavy the query should be to be eligible for parallel plan 
  google.protobuf.Int64Value cost_threshold_for_parallelism = 2 [(value) = "1-999999"];

  //setup option SQLCOLLATION - collation used for system databases across the instance. Not easy to change after installation. Determines if instance is case sensitive, accent sensitive etc.
  string sqlcollation = 3;
  //Logon auditing option. 0 - no logon audit, 1 - failed logins only, 2 - Successfull logins only (not recommended),  3 - All logins (not recommended).
  //https://docs.microsoft.com/en-us/sql/ssms/configure-login-auditing-sql-server-management-studio?view=sql-server-ver15
  google.protobuf.Int64Value audit_level = 4 [(value) = "0-3"];

  //sp_configure option for managing FILESTREAM technology (storing blob data outside of datase). 0 - FILESTREAM is disabled, 1 - Enables FILESTREAM for Transact-SQL access, 2- Enables FILESTREAM for Transact-SQL and Win32 streaming access.
  //https://docs.microsoft.com/en-us/sql/relational-databases/blob/enable-and-configure-filestream?view=sql-server-ver15
  //https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/filestream-access-level-server-configuration-option?view=sql-server-ver15
  google.protobuf.Int64Value filestream_access_level = 5 [(value) = "0-2"];

  //sp_configure option for managing database pages fullness. 0 or 100 means full page usage (no space reserve), anything in between equals to percent of fullness maintained when index is created or rebuilt to avoid future page splits
  //https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/configure-the-fill-factor-server-configuration-option?view=sql-server-ver15
  google.protobuf.Int64Value fill_factor_percent = 6 [(value) = "0-100"];

  //sp_configure option. Determines how to resolve the in-doubt distributed transactions. 0 means no autmatic resolution, 1 - assume them commited, 2 - assume them uncommitted and roll them back.
  //https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/in-doubt-xact-resolution-server-configuration-option?view=sql-server-ver15
  google.protobuf.Int64Value in_doubt_xact_resolution = 7 [(value) = "0-2"];

  // sp_configure option. If enabled then plans are cached only after second execution. Allows to avoid SQL cache bloat because of single-use plans
  //https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/optimize-for-ad-hoc-workloads-server-configuration-option?view=sql-server-ver15
  google.protobuf.BoolValue optimize_for_ad_hoc_workloads = 8;

  // sp_configure option enabling cross db ownership chaining - complex and convoluted security option. Having access to stored procedure in one database that refers to an object in another database that you don't have explicit access, you'll be able to execute the procedure without permission related error.
  //https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/cross-db-ownership-chaining-server-configuration-option?view=sql-server-ver15
  google.protobuf.BoolValue cross_db_ownership_chaining = 9;

}

message SQLServerConfigSet2016sp2 {
  // Effective settings for a sqlserver 2016 sp2 cluster (a combination of settings defined
  // in [user_config] and [default_config]).
  SQLServerConfig2016sp2 effective_config = 1;

  // User-defined settings for a sqlserver 2016 sp2 cluster.
  SQLServerConfig2016sp2 user_config = 2;

  // Default configuration for a sqlserver 2016 sp2 cluster.
  SQLServerConfig2016sp2 default_config = 3;
}
