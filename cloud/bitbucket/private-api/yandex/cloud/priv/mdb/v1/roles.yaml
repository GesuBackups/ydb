role_groups:
  mdb:
    name: MDB roles

roles:

  mdb.admin:
    groups: [mdb]
    name: Администратор MDB
    visibility: public
    description: полный доступ ко всем методам MDB
    includedRoles:
      - mdb.viewer
      - vpc.user
      - managed-elasticsearch.admin
    permissions:
      - mdb.all.create
      - mdb.all.delete
      - mdb.all.modify
      - mdb.clusters.getSecret

  mdb.viewer:
    groups: [mdb]
    name: Read-only пользователь MDB
    visibility: public
    description: доступ к читающим методам MDB
    includedRoles:
      - managed-elasticsearch.viewer
    permissions:
      - mdb.all.read
      - mdb.clusterInfo.read
      - mdb.clusters.getLogs
      - mdb.dataproc.agentOperations
      - mdb.dataproc.agentReport
      - mdb.quotas.read
      - iam.folders.get
      - resource-manager.folders.get

  mdb.editor:
    groups: [ mdb ]
    name: Editor пользователь MDB
    visibility: public
    description: доступ к мутирующим методам MDB
    includedRoles:
      - mdb.viewer
      - managed-elasticsearch.editor
    permissions:
      - mdb.all.create
      - mdb.all.delete
      - mdb.all.modify

  yc.yandex-team.ru.mdb.admin:
    groups: [mdb]
    name: Администратор MDB
    visibility: internal
    description: полный доступ ко всем методам MDB для yc.yandex-team.ru
    includedRoles:
      - managed-elasticsearch.admin
    permissions:
    - iam.authorizedKeys.get
    - iam.authorizedKeys.{create,delete,update}
    - iam.serviceAccounts.createAccessKey
    - iam.serviceAccounts.createApiKey
    - iam.serviceAccounts.deleteAccessKey
    - iam.serviceAccounts.deleteApiKey
    - iam.serviceAccounts.updateAccessKey
    - iam.serviceAccounts.updateApiKey
    - iam.serviceAccounts.getAccessKey
    - iam.serviceAccounts.getApiKey
    - iam.serviceAccounts.listAccessKeys
    - iam.serviceAccounts.listApiKeys
    - iam.serviceAccounts.{create,delete,update}
    - iam.serviceAccounts.{get,list}
    - iam.tokenKeys.get
    - iam.tokenKeys.{create,delete,update}
    - iam.userAccounts.get
    - marketplace.agreements.get
    - mdb.all.modify
    - mdb.all.read
    - mdb.all.{create,delete}
    - mdb.clusterInfo.read
    - mdb.quotas.read

  mdb.reader:
    groups: [mdb]
    name: Read-only-пользователь MDB
    visibility: internal
    description: доступ ко всем немодифицирующим методам MDB
    includedRoles:
      - managed-elasticsearch.viewer
    permissions:
    - marketplace.agreements.get
    - mdb.all.read
    - mdb.clusterInfo.read
    - mdb.quotas.read

  mdb.support:
    groups: [mdb, support]
    name: Техподдержка MDB
    visibility: internal
    description: ' доступ к методам поддержки MDB'
    includedRoles:
      - managed-elasticsearch.support
    permissions:
    - compute.diskPooling.get
    - compute.diskPooling.{delete,update}
    - computeInternal.diskPooling.get
    - computeInternal.diskPooling.{delete,update}
    - mdb.all.support

  mdb.auditor:
    groups: [mdb]
    name: Аудитор MDB
    visibility: public
    description: Auditor пользователь MDB
    includedRoles:
      - managed-elasticsearch.auditor
    permissions:
      - mdb.all.read
      - mdb.clusterInfo.read
      - mdb.quotas.read
      - iam.folders.get
      - resource-manager.folders.get

  internal.mdb.internalapi:
    groups: [mdb]
    name: (Внутренняя) MDB API
    visibility: internal
    description: Role for service account of MDB internal API
    permissions:
    - compute.hostGroups.get

  internal.mdbagent:
    groups: [mdb]
    name: (Внутренняя) Агент MDB
    visibility: internal
    description: ' доступ к функциям для подключения к сетям пользователей'
    includedRoles:
    - iam.serviceAccounts.user
    permissions:
    - compute.disks.use
    - compute.hostGroups.use
    - compute.instanceGroups.use
    - compute.instances.assignSecurityGroup
    - compute.networkInterfaces.attach
    - compute.placementGroups.use
    - compute.snapshots.use
    - computeInternal.instances.assignSecurityGroup
    - computeInternal.networkInterfaces.attach
    - iam.folders.list
    - vpc.addresses.use
    - vpc.addresses.{get,list}
    - vpc.subnets.use
    - vpc.subnets.{get,list}

  internal.mdbdnsagent:
    groups: [mdb]
    name: Агент MDB DNS
    visibility: internal
    description: управление DNS записями в сетях пользователей
    permissions:
    - vpcInternal.networks.manageDnsRecords
    - vpc.networks.manageDnsRecords

  internal.mdbiamviewer:
    groups: [mdb]
    name: (Внутренняя) Читатель
    visibility: internal
    description: Роль для членов облаков внутренней инсталляции IAM для MDB. https://st.yandex-team.ru/CLOUD-14219
    permissions:
    - iam.cloudUsers.list
    - iam.roles.list
    - mdb.clusterInfo.read
    - mdb.quotas.read
    - managed-elasticsearch.quotas.get

  internal.ydpagent:
    groups: [mdb]
    name: (Внутреняя) MDB Worker
    visibility: internal
    description: доступ к Compute Internal и S3 для управления из фолдеров пользователей
    includedRoles:
      - iam.serviceAccounts.admin
    permissions:
    - compute.diskOperations.list
    - compute.disks.use
    - compute.disks.{create,delete,update}
    - compute.disks.{get,list}
    - compute.hostGroups.{get,use}
    - compute.imageOperations.list
    - compute.images.create
    - compute.images.getLatestByFamily
    - compute.images.use
    - compute.images.{get,list}
    - compute.images.ignoreWhitelist
    - compute.instanceGroups.use
    - compute.instanceOperations.list
    - compute.instances.assignServiceAccount
    - compute.instances.createCustomFqdn
    - compute.instances.createMultiInterface
    - compute.instances.getSerialPortOutput
    - compute.instances.restart
    - compute.instances.start
    - compute.instances.stop
    - compute.instances.{create,delete,update}
    - compute.instances.{internalCreate,internalUpdate,createNvmeDisks,updateNvmeDisks}
    - compute.instances.{get,list}
    - compute.networkInterfaces.{get,list}
    - compute.operations.cancel
    - compute.operations.{get,list}
    - compute.placementGroups.use
    - compute.quotas.getCloudLimit
    - compute.quotas.getFolderLimit
    - compute.snapshots.delete
    - compute.snapshots.use
    - compute.zones.{get,list}
    - computeInternal.diskOperations.list
    - computeInternal.disks.{create,delete,update}
    - computeInternal.disks.{get,list}
    - computeInternal.imageOperations.list
    - computeInternal.images.create
    - computeInternal.images.getLatestByFamily
    - computeInternal.images.use
    - computeInternal.images.{get,list}
    - computeInternal.instanceOperations.list
    - computeInternal.instances.assignServiceAccount
    - computeInternal.instances.createCustomFqdn
    - computeInternal.instances.createMultiInterface
    - computeInternal.instances.restart
    - computeInternal.instances.start
    - computeInternal.instances.stop
    - computeInternal.instances.{create,delete,update}
    - computeInternal.instances.{get,list}
    - computeInternal.networkInterfaces.{get,list}
    - computeInternal.operations.cancel
    - computeInternal.operations.{get,list}
    - computeInternal.snapshots.delete
    - computeInternal.tasks.cancel
    - computeInternal.tasks.{get,list}
    - computeInternal.zones.{get,list}
    - iam.accessBinding.delete
    - iam.accessBindings.list
    - iam.accessBindings.update
    - iam.serviceAccounts.{list,update}AccessBindings
    - resource-manager.clouds.{list,update}AccessBindings
    - resource-manager.folders.{list,update}AccessBindings
    - resource-manager.clouds.listPermissionStages
    - s3.buckets.createBucket
    - s3.buckets.deleteBucket
    - s3.buckets.getBucketLocation
    - s3.buckets.listBucket
    - s3.buckets.listBucketMultipartUploads
    - s3.objects.abortMultipartUpload
    - s3.objects.deleteObject
    - s3.objects.getObject
    - s3.objects.listMultipartUploadParts
    - s3.objects.putObject
    - vpc.addresses.createExternal
    - vpc.addresses.use
    - vpc.addresses.{get,list}
    - vpc.networks.{get,list}
    - vpc.subnets.use
    - vpc.subnets.{get,list}

  mdb.quotaManager:
    groups: [mdb]
    name: Manage MDB Quotas
    description: Role for syncing quotas with other systems.
    visibility: internal
    permissions:
      - mdb.all.support
      - mdb.quotas.read

  internal.mdb.k8sClusterUser:
    groups: [mdb]
    name: User of K8S Cluster
    description: Manages K8S for MDB ControlPlane stands. Creates balancers, etc.
    visibility: internal
    includedRoles:
      - internal.vpc.address.yandexOnlyAdmin

  mdb.supportMdb:
    groups: [mdb]
    name: Support MDB
    description: Role for support engineers
    visibility: internal
    includedRoles:
      - managed-elasticsearch.support
    permissions:
      - mdb.all.read
      - mdb.clusterInfo.read
      - mdb.quotas.read
      - mdb.all.support

  mdb.supportAdmin:
    groups: [mdb, support]
    name: Support MDB Admin
    description: Privileged operations for support engineers
    visibility: internal
    includedRoles:
      - mdb.supportMdb
      - managed-elasticsearch.supportAdmin
    permissions: []

  internal.mdb.imageManager:
    groups: [mdb]
    name: Image manager
    description: Role for managing images
    visibility: internal
    permissions:
      - compute.diskPooling.get
      - compute.diskPooling.{delete,update}
      - compute.imageOperations.list
      - compute.images.{create,delete,get,getLatestByFamily,list,update,use,listReferences}
      - compute.images.ignoreWhitelist
      - compute.operations.{get,list}
      - computeInternal.diskPooling.get
      - computeInternal.diskPooling.{delete,update}

  internal.mdb.deployUser:
    groups: [mdb]
    name: Deploy user
    description: Role for using mdb deploy api
    visibility: internal
    permissions:
      - mdb.internal.deploy

  internal.mdb.mlockUser:
    groups: [mdb]
    name: Mlock user
    description: Role for using mdb mlock api
    visibility: internal
    permissions:
      - mdb.internal.mlock

  internal.mdb.secretsUser:
    groups: [mdb]
    name: MDB Secrets user
    description: Role for using mdb secrets api
    visibility: internal
    permissions:
      - mdb.internal.secrets

  internal.mdb.cmsUser:
    groups: [mdb]
    name: MDB CMS user
    description: Role for using mdb CMS api
    visibility: internal
    permissions:
      - mdb.internal.cms

  internal.mdb.clusterAgent:
    groups: [mdb]
    name: (Внутренняя) Роль сервисного аккаунта, создаваемого для каждого кластера
    description: Роль сервисного аккаунта, от имени которого приложения, запускаемые на хостах некоторых типов MDB кластеров, ходят в API Облака
    visibility: internal
    permissions:
      - managed-kafka.topics.sync

  mdb.onCall:
    groups: [mdb, staff]
    name: On-call MDB
    visibility: internal
    description: Role for MDB on-call engineers
    includedRoles:
      - onCall
      - mdb.viewer
      - managed-elasticsearch.onCall

  mdb.onCallAdmin:
    groups: [mdb, staff]
    name: On-call MDB Admin
    visibility: internal
    description: Role for MDB on-call admins
    includedRoles:
      - mdb.onCall
      - mdb.supportAdmin
      - mdb.editor

  internal.mdb.cleaner:
    groups: [mdb]
    name: DBaaS Cleaner
    visibility: internal
    description: Умеет удалять защищенные от удаления кластера MDB
    permissions:
      - mdb.all.delete
      - mdb.all.forceDelete
      - managed-elasticsearch.clusters.delete
      - managed-elasticsearch.clusters.forceDelete
