syntax = "proto3";

package yandex.cloud.priv.mdb.mongodb.v1;

import "google/protobuf/timestamp.proto";

option go_package = "a.yandex-team.ru/cloud/bitbucket/private-api/yandex/cloud/priv/mdb/mongodb/v1;mongodb";
option java_outer_classname = "MGPDIAG";

message ProfilerStats {
    // Collect timestamp in [RFC3339](https://www.ietf.org/rfc/rfc3339.txt) text format.
    google.protobuf.Timestamp time = 1;
    map<string, string> dimensions = 2;
    int64 value = 3;
}

message ProfilerRecord {
    // Collect timestamp in [RFC3339](https://www.ietf.org/rfc/rfc3339.txt) text format.
    google.protobuf.Timestamp time = 1;
    string raw = 2;
    string request_form = 3;
    string hostname = 4;
    string user = 5;
    string ns = 6;
    string operation = 7;
    int64 duration = 8;
    string plan_summary = 9;
    int64 response_length = 10;
    int64 keys_examined = 11;
    int64 documents_examined = 12;
    int64 documents_returned = 13;
}

message TopForms {
    string request_form = 1;
    string plan_summary = 2;
    int64 queries_count = 3;
    int64 total_queries_duration = 4;
    int64 avg_query_duration = 5;
    int64 total_response_length = 6;
    int64 avg_response_length = 7;
    int64 total_keys_examined = 8;
    int64 total_documents_examined = 9;
    int64 total_documents_returned = 10;
    int64 keys_examined_per_document_returned = 11;
    int64 documents_examined_per_document_returned = 12;
}

message PossibleIndexes {
    string database = 1;
    string collection = 2;
    string index = 3;
    int64 request_count = 4;
}

enum GroupBy {
    GROUP_BY_UNSPECIFIED = 0;
    FORM = 1;
    NAMESPACE = 2;
    HOSTNAME = 3;
    USER = 4;
    SHARD = 5;
}

enum AggregateBy {
    AGGREGATE_BY_UNSPECIFIED = 0;
    DURATION = 1;
    RESPONSE_LENGTH = 2;
    KEYS_EXAMINED = 3;
    DOCUMENTS_EXAMINED = 4;
    DOCUMENTS_RETURNED = 5;
    COUNT = 6;
}

enum AggregationFunction {
    AGGREGATION_FUNCTION_UNSPECIFIED = 0;
    SUM = 1;
    AVG = 2;
}
