syntax = "proto3";

package yandex.cloud.priv.storage.extension.v1;

import "google/api/annotations.proto";
import "yandex/cloud/api/operation.proto";
import "yandex/cloud/api/tools/options.proto";
import "yandex/cloud/priv/operation/operation.proto";
import "yandex/cloud/priv/validation.proto";
import "yandex/cloud/priv/sensitive.proto";
import "yandex/cloud/priv/storage/extension/v1/https_config.proto";


option go_package = "a.yandex-team.ru/cloud/bitbucket/private-api/yandex/cloud/priv/storage/extension/v1;extension";

message SelfManagedHTTPSConfigParams {
    string certificate_pem = 1 [(length) = "<=3145728", (sensitive) = true, (sensitive_type) = SENSITIVE_CRC]; // 3 MiB
    string private_key_pem = 2 [(length) = "<=3145728", (sensitive) = true, (sensitive_type) = SENSITIVE_CRC]; // 3 MiB
}

message ManagedHTTPSConfigParams {
}

message CertificateManagerHTTPSConfigParams {
    string certificate_id = 1;
}

message PutHTTPSConfigRequest {
    string bucket_id = 1 [(length) = "3-63"];
    oneof params {
        option (exactly_one) = true;

        SelfManagedHTTPSConfigParams self_managed = 2;
        ManagedHTTPSConfigParams managed = 3;
        CertificateManagerHTTPSConfigParams certificate_manager = 4;
    }
}

message GetHTTPSConfigRequest {
    string bucket_id = 1 [(length) = "3-63"];
}

message DeleteHTTPSConfigRequest {
    string bucket_id = 1 [(length) = "3-63"];
}

service HTTPSConfigService {
    rpc Put (PutHTTPSConfigRequest) returns (operation.Operation) {
        option (google.api.http) = {
            put: "/storage-extension/v1/https_config/{bucket_id}"
            body: "*"
        };
        option (yandex.cloud.api.operation) = {
          metadata: "PutHTTPSConfigMetadata"
          response: "HTTPSConfig"
        };
        option (yandex.cloud.api.tools.method).lint_skip.http_verb = true;
    }

    rpc Get (GetHTTPSConfigRequest) returns (HTTPSConfig) {
        option (google.api.http) = {
            get: "/storage-extension/v1/https_config/{bucket_id}"
        };
    }

    rpc Delete (DeleteHTTPSConfigRequest) returns (operation.Operation) {
        option (google.api.http) = {
            delete: "/storage-extension/v1/https_config/{bucket_id}"
        };
        option (yandex.cloud.api.operation) = {
          metadata: "DeleteHTTPSConfigMetadata"
          response: "google.protobuf.Empty"
        };
    }
}

message PutHTTPSConfigMetadata {
    string bucket_id = 1;
}

message DeleteHTTPSConfigMetadata {
    string bucket_id = 1;
}
