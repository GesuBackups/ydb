syntax = "proto3";

package yandex.cloud.priv.platform.alb.v1;

import "google/protobuf/timestamp.proto";
import "yandex/cloud/priv/platform/alb/v1/locality.proto";
import "yandex/cloud/priv/validation.proto";

option go_package = "a.yandex-team.ru/cloud/bitbucket/private-api/yandex/cloud/priv/platform/alb/v1;alb";
option java_outer_classname = "PALTG";

message TargetGroup {
  // UID generated by ALB.
  string id = 1;

  // Name. TODO: requirements.
  string name = 2;

  // Comment.
  string description = 3;

  // For auth checks.
  string folder_id = 4;

  // More comments.
  map<string, string> labels = 5;

  // NOTE: all endpoints must use the same address_type - either ip or hostname.
  // (IPs go to EDS, and hostnames go to CDS)
  repeated Target targets = 6;

  // Contains list of backend group IDs that refer to this target group.
  // Deprecated, use `backend_group_ids`.
  repeated string referenced_by = 7;

  google.protobuf.Timestamp created_at = 8;

  // Contains list of backend group IDs that refer to this target group.
  repeated string backend_group_ids = 9;

  string cloud_id = 10;

  // Last time when the target group was modified.
  google.protobuf.Timestamp modified_at = 11;

  // UA or SA that created the target group.
  string created_by = 12;

  // Next field number is 13.
}

message Target {
  oneof address_type {
    option (exactly_one) = true;

    // Endpoint address.
    string ip_address = 1;

    // DNS name. partially implemented, see CLOUD-35786.
    string hostname = 2;
  }

  // Endpoint port. Takes priority over Backend::port and Listener's port.
  int64 port = 3 [(value) = "0-65535"];

  // Zone. Must be set in order to use the LoadBalancingConfig::locality_aware_routing_percent.
  Locality locality = 4;

  // Subnet, for future use.
  string subnet_id = 5;

  // If set, will not require `subnet_id` to validate the target.
  // Only one of `subnet_id` or `external_address` should be set.
  // Should not be exposed to public API.
  bool external_address = 6;

  // If set, will not require `subnet_id` to validate the target.
  // Instead, the address should belong to one of the following ranges:
  // 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16
  // Only one of `subnet_id` or `private_ipv4_address` should be set.
  bool private_ipv4_address = 7;
}
