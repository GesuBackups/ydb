role_groups:
  alb:
    name: alb roles

roles:
  alb.admin.pseudo:
    groups: [alb]
    name: Администратор ALB
    visibility: public
    pseudorole: true
    description: доступ ко всем функциям ALB
    includedRoles:
    - alb.editor.pseudo
    permissions: []

  alb.editor.pseudo:
    groups: [alb]
    name: Редактирование ALB
    visibility: public
    pseudorole: true
    description: доступ ко всем функциям ALB
    includedRoles:
    - alb.user.pseudo
    permissions:
    - alb.backendGroups.create
    - alb.backendGroups.delete
    - alb.backendGroups.update
    - alb.routers.create
    - alb.routers.delete
    - alb.routers.update
    - alb.loadBalancers.create
    - alb.loadBalancers.delete
    - alb.loadBalancers.update
    - alb.targetGroups.create
    - alb.targetGroups.delete
    - alb.targetGroups.update
    - alb.virtualHosts.update

  alb.user.pseudo:
    groups: [alb]
    name: использование объектов ALB
    visibility: public
    pseudorole: true
    description: использование объектов ALB
    includedRoles:
    - alb.viewer.pseudo
    permissions:
    - alb.targetGroups.use
    - alb.backendGroups.use
    - alb.routers.use
    - alb.loadBalancers.use

  alb.viewer.pseudo:
    groups: [alb]
    name: Только чтение ALB
    visibility: public
    pseudorole: true
    description: доступ к функциям ALB на чтение
    permissions:
    - alb.quotas.get
    - alb.backendGroups.get
    - alb.backendGroups.list
    - alb.routers.get
    - alb.routers.list
    - alb.loadBalancers.get
    - alb.loadBalancers.list
    - alb.targetGroups.get
    - alb.targetGroups.list
    - alb.virtualHosts.get
    - alb.virtualHosts.list

  alb.admin:
    groups: [alb]
    name: Администратор ALB
    visibility: public
    description: доступ ко всем функциям ALB
    includedRoles:
    - alb.admin.pseudo
    permissions: []

  alb.editor:
    groups: [alb]
    name: Рекдактирование ALB
    visibility: public
    description: доступ ко всем функциям ALB
    includedRoles:
    - alb.editor.pseudo
    - load-balancer.privateAdmin
    - vpc.user
    permissions: []

  alb.user:
    groups: [alb]
    name: Использование ALB
    visibility: public
    description: доступ ко всем функциям ALB на чтение
    includedRoles:
    - alb.user.pseudo
    permissions: []

  alb.viewer:
    groups: [alb]
    name: Только чтение ALB
    visibility: public
    description: доступ к функциям ALB на чтение
    includedRoles:
    - alb.viewer.pseudo
    permissions: []

  internal.alb.als.agent:
    groups: [alb]
    name: (Внутренняя) ALS
    visibility: internal
    description: доступ к LoadBalancer на чтение для ALS
    permissions:
    - alb.loadBalancers.get
    - resource-manager.folders.get # get cloud_id from folder_id

  internal.alb.xds.agent:
    groups: [alb]
    name: (Внутренняя) XDS
    visibility: internal
    description: доступ к функциям нужным XDS
    permissions:
    - alb.routers.{get,list}
    - alb.backendGroups.{get,list}
    - alb.targetGroups.{get,list}
    - alb.loadBalancers.{get,list}
    - alb.virtualHosts.{get,list}

  internal.alb.externalObjectsUser:
    groups: [alb]
    name: (Внутренняя) ALB API
    visibility: internal
    description: доступ к объектам ALB в других облаках
    permissions:
      - alb.routers.externalUse
      - alb.backendGroups.externalUse
      - alb.targetGroups.externalUse

  internal.alb.xcloud.agent:
    groups: [alb]
    name: (Внутренняя) ALB API
    visibility: internal
    description: all-cloud доступ к функциям нужным для валидации/создания L7 в пользовательском VPC
    includedRoles:
      # https://st.yandex-team.ru/CLOUD-85903
      - internal.vpc.address.yandexOnlyAdmin
    permissions:
    # validate provided compute zones
    - compute.zones.{get,list}
    # manipulate access log loggroups in user cloud
    - logs.logGroups.{get,list,create,update,delete}
    # validate provided folders
    - resource-manager.folders.get
    # use client networks (for L3 load balancer create)
    - vpc.networks.use
    # validate provided networks
    - vpc.networks.get
    # ability to create multiinterface crosscloud VMs
    - vpc.networks.bridge
    # use client subnets for L7 VMs and internal L3 load balancers
    - vpc.subnets.use
    # validate provided subnets
    - vpc.subnets.{get,list}
    # use user-provided addresses for load balancers
    - vpc.addresses.use
    # validate provided addresses
    - vpc.addresses.{get,list}
    # use user-provided security groups
    - vpc.securityGroups.use
    # validate provided security groups
    - vpc.securityGroups.{list,get}
    # ability to use ipv6 subnets/network interfaces
    - vpc.useIpv6
    # ability to create NLB with targets in user-provided network
    # see `ylb.networkLoadBalancers.publicEditor.pseudo` role
    - vpc.networks.configureExternalAccess
    # ability to validate user-provided certificates
    - certificate-manager.certificates.get
    # to reference certificates from load-balancer
    - certificate-manager.certificates.listReferences
    - certificate-manager.certificates.updateReferences
    # to manage security groups for L3 HC in user-provided network.
    # https://st.yandex-team.ru/CLOUD-61929
    - vpc.networks.{createSecurityGroup,deleteSecurityGroup,updateSecurityGroup}
    - vpc.networks.security.{addEgressRule,deleteEgressRule,addIngressRule,deleteIngressRule}
    # https://st.yandex-team.ru/CLOUD-67519
    # To create/delete addresses in user folder.
    - vpc.addresses.createExternal
    - vpc.addresses.{delete,update}

  internal.alb.xcloud.envoy.igManager:
    groups: [alb]
    name: (Внутренняя) ALB API
    visibility: internal
    description: all-cloud доступ к функциям нужным для instance group manager SA L7-балансеров
    permissions:
    - vpc.networks.use
    - vpc.networks.bridge
    - vpc.subnets.use
    - vpc.securityGroups.use
    - vpc.useIpv6
    # https://st.yandex-team.ru/CLOUD-41956
    # get permissions required to create IG with user provided subnets or networks.
    - vpc.subnets.get
    - vpc.networks.get

  alb.support:
    groups: [alb, support]
    name: Support ALB
    description: Role for support engineers
    visibility: internal
    includedRoles:
    - alb.viewer.pseudo
    permissions:
    - alb.quotas.set
    - alb.quotas.get

  alb.supportAdmin:
    groups: [alb, support]
    name: Support ALB Admin
    description: Privileged operations for support engineers
    visibility: internal
    includedRoles:
    - alb.support
    permissions: []

  alb.onCall:
    groups: [ alb, staff ]
    name: OnCall ALB
    description: Role for on-call engineers
    visibility: internal
    includedRoles:
    - alb.support
    # CLOUD-84031: We need `alb.user` role to be able to update
    # our ALB service balancers that are using routers from external folders.
    - alb.user
    - onCall
    permissions: []

  alb.onCallAdmin:
    groups: [ alb, staff ]
    name: OnCall admin ALB
    description: Role for on-call ALB admins
    visibility: internal
    includedRoles:
    - alb.onCall
    - alb.admin
    permissions:
    # Most of the alb.xcloud.agent role permissions to fix user ALB resources.
    # ability to create NLB with targets in user-provided network
    # see `ylb.networkLoadBalancers.publicEditor.pseudo` role
    - vpc.networks.configureExternalAccess
    # to reference certificates from load-balancer
    - certificate-manager.certificates.listReferences
    - certificate-manager.certificates.updateReferences
    # to manage security groups for L3 HC in user-provided network.
    # https://st.yandex-team.ru/CLOUD-61929
    - vpc.networks.{createSecurityGroup,deleteSecurityGroup,updateSecurityGroup}
    - vpc.networks.security.{addEgressRule,deleteEgressRule,addIngressRule,deleteIngressRule}
    # https://st.yandex-team.ru/CLOUD-67519
    # To create/delete addresses in user folder.
    - vpc.addresses.createExternal
    - vpc.addresses.{delete,update}
