syntax = "proto3";

package yandex.cloud.priv.cic.v1.inner.agent.device.routing_policy;

option go_package = "a.yandex-team.ru/cloud/bitbucket/private-api/yandex/cloud/priv/cic/v1/inner/agent/device/routing_policy;cic";
option java_outer_classname = "PCIADBP";


message Community {
  int64 asn = 2;
  int64 value = 3;
}


enum ExtCommunityType {
  EXT_COMMUNITY_TYPE_UNSPECIFIED = 0;
  EXT_COMMUNITY_TYPE_ROUTE_TARGET = 1;
}


message ExtCommunity {
  ExtCommunityType type = 1;
  int64 admin = 2;
  int64 value = 3;
}


message BgpDefinedSets {

  message CommunitySet {
    string name = 1;
    repeated Community members = 2;
  }
  
  message ExtCommunitySet {
    string name = 1;
    repeated ExtCommunity members = 2;
  }

  map<string, CommunitySet> community_sets = 1;
  map<string, ExtCommunitySet> ext_community_sets = 2;
}


message BgpConditions {
  repeated string community_set = 1; //deviation
  repeated string ext_community_set = 2; //deviation
}


enum BgpSetCommunityOptionType {
  BGP_SET_COMMUNITY_OPTION_TYPE_UNSPECIFIED = 0;
  BGP_SET_COMMUNITY_OPTION_TYPE_ADD = 1;
  BGP_SET_COMMUNITY_OPTION_TYPE_REPLACE = 2;
  BGP_SET_COMMUNITY_OPTION_TYPE_REMOVE = 3;
}


message BgpActions{
  enum Method {
    METHOD_UNSPECIFIED = 0;
    METHOD_INLINE = 1;
    METHOD_REFERENCE = 2;
  }
  
  message SetCommunity {
    Method method = 1;
    BgpSetCommunityOptionType bgp_set_community_option_type = 2;
    repeated Community communities  = 3;
    repeated string community_refs = 4;
  }

  message SetExtCommunity {
    Method method = 1;
    BgpSetCommunityOptionType bgp_set_community_option_type = 2;
    repeated ExtCommunity communities  = 3;
    repeated string community_refs = 4;
  }

  SetCommunity set_community = 1;
  SetExtCommunity set_ext_community = 2;
}
