syntax = "proto3";

package yandex.cloud.priv.kms.v1.hsm;

import "yandex/cloud/priv/validation.proto";
import "yandex/cloud/priv/sensitive.proto";

option go_package = "a.yandex-team.ru/cloud/bitbucket/private-api/yandex/cloud/priv/kms/v1/hsm;hsm";
option java_outer_classname = "PHSMCS";

service HsmCryptoService {

    rpc Encrypt (HsmEncryptRequest) returns (HsmEncryptResponse);

    rpc Decrypt (HsmDecryptRequest) returns (HsmDecryptResponse);
}

message HsmEncryptRequest {
    string key_name = 1 [(required) = true];
    bytes encrypted_key_contents = 2 [(required) = true];
    bytes encrypted_mac_key_contents = 3;
    // Additional authenticated data, optional
    bytes aad_context = 4 [(length) = "<=8192", (sensitive) = true];
    // Plaintext to be encrypted
    bytes plaintext = 5 [(required) = true, (length) = "<=32768", (sensitive) = true];
}

message HsmEncryptResponse {
    string key_name = 1;
    bytes ciphertext = 2 [(sensitive) = true]; // encrypted text
}

message HsmDecryptRequest {
    string key_name = 1 [(required) = true];
    bytes encrypted_key_contents = 2 [(required) = true];
    bytes encrypted_mac_key_contents = 3;
    // Additional authenticated data, optional
    bytes aad_context = 4 [(length) = "<=8192", (sensitive) = true];
    // Encrypted text to be decrypted
    bytes ciphertext = 5 [(required) = true, (sensitive) = true];
}

message HsmDecryptResponse {
    string key_name = 1;
    bytes plaintext = 2 [(sensitive) = true]; // decrypted text
}
