syntax = "proto3";

package yandex.cloud.priv.certificatemanager.v1;

import "yandex/cloud/priv/validation.proto";
import "yandex/cloud/priv/certificatemanager/v1/certificate_content_service.proto";

option go_package = "a.yandex-team.ru/cloud/bitbucket/private-api/yandex/cloud/priv/certificatemanager/v1;certificatemanager";
option java_outer_classname = "PCIS";

service IntegrationService {

  rpc BatchGetChangedMetadata (BatchGetChangedMetadataRequest) returns (BatchGetChangedMetadataResponse);

  rpc BatchGetContent (BatchGetCertificateContentRequest) returns (BatchGetCertificateContentResponse);

  rpc GetDomainMeta (GetDomainMetaRequest) returns (GetDomainMetaResponse);
}

message GetChangedMetadataRequest {
  string certificate_id = 1 [(required) = true, (length) = "<=50"];
  string version_id = 2;
}

message BatchGetChangedMetadataRequest {
  repeated GetChangedMetadataRequest certificate_ids = 1;
}

message GetDomainMetaRequest {
  string domain_id = 1;
}

message GetDomainMetaResponse {
  enum Status {
    STATUS_UNSPECIFIED = 0;
    VALID = 1;
    INVALID = 2;
  }
  string domain = 1;
  string certificate_id = 2;
  Status status = 3;
}

message CertificateContentMetadata {
  string certificate_id = 1;
  string version_id = 2;
  repeated string domains = 3;
}

message BatchGetChangedMetadataResponse {
  repeated CertificateContentMetadata certificates = 1;
}

message BatchGetCertificateContentRequest {
  repeated string certificate_ids = 1;
}

message BatchGetCertificateContentResponse {
  repeated GetCertificateContentResponse certificates = 1;
}
