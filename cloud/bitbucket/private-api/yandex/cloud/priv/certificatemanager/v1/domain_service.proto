syntax = "proto3";

package yandex.cloud.priv.certificatemanager.v1;

import "google/protobuf/field_mask.proto";
import "yandex/cloud/api/operation.proto";
import "yandex/cloud/api/tools/options.proto";
import "yandex/cloud/priv/operation/operation.proto";
import "yandex/cloud/priv/validation.proto";
import "yandex/cloud/priv/certificatemanager/v1/domain.proto";
import "yandex/cloud/priv/reference/reference.proto";
import "yandex/cloud/priv/access/access.proto";


option go_package = "a.yandex-team.ru/cloud/bitbucket/private-api/yandex/cloud/priv/certificatemanager/v1;certificatemanager";
option java_outer_classname = "PDS";

service DomainService {

    rpc Get (GetDomainRequest) returns (Domain);

    rpc List (ListDomainsRequest) returns (ListDomainsResponse);

    rpc Create (CreateDomainRequest) returns (operation.Operation) {
        option (yandex.cloud.api.operation) = {
      metadata: "CreateDomainMetadata"
      response: "Domain"
    };
    }

    rpc Update (UpdateDomainRequest) returns (operation.Operation) {
        option (yandex.cloud.api.operation) = {
      metadata: "UpdateDomainMetadata"
      response: "Domain"
    };
    }

    rpc SetPrimaryCertificate (SetPrimaryCertificateRequest) returns (operation.Operation) {
        option (yandex.cloud.api.operation) = {
      metadata: "SetPrimaryCertificateMetadata"
      response: "Domain"
    };
    }

    rpc Delete (DeleteDomainRequest) returns (operation.Operation) {
        option (yandex.cloud.api.operation) = {
      metadata: "DeleteDomainMetadata"
      response: "google.protobuf.Empty"
    };
    }

    rpc ListReferences (ListDomainReferencesRequest) returns (ListDomainReferencesResponse);

    rpc UpdateReferences (UpdateDomainReferencesRequest) returns (operation.Operation) {
        option (yandex.cloud.api.operation) = {
      metadata: "UpdateDomainReferencesMetadata"
      response: "google.protobuf.Empty"
    };
    }

    rpc ListOperations (ListDomainOperationsRequest) returns (ListDomainOperationsResponse);

    rpc ListAccessBindings (access.ListAccessBindingsRequest) returns (access.ListAccessBindingsResponse);

    rpc SetAccessBindings (access.SetAccessBindingsRequest) returns (operation.Operation) {
        option (yandex.cloud.api.operation) = {
      metadata: "access.SetAccessBindingsMetadata"
      response: "google.protobuf.Empty"
    };
    }

    rpc UpdateAccessBindings (access.UpdateAccessBindingsRequest) returns (operation.Operation) {
        option (yandex.cloud.api.operation) = {
      metadata: "access.UpdateAccessBindingsMetadata"
      response: "google.protobuf.Empty"
    };
    }
}

enum DomainView {
    option (cloud.api.tools.enumeration).lint_skip.unspecified_value = true;
    BASIC_VIEW = 0;
    FULL_VIEW = 1;
}

message GetDomainRequest {
    string domain_id = 1 [(required) = true, (length) = "<=50"];
    DomainView view = 2;
}

message ListDomainsRequest {
    string folder_id = 1 [(required) = true, (length) = "<=50"];
    int64 page_size = 2 [(value) = "<=1000"];
    string page_token = 3 [(length) = "<=100"];
    string filter = 4;
    string order_by = 5;
}

message ListDomainsResponse {
    repeated Domain domains = 1;
    string next_page_token = 2;
}

message CreateDomainRequest {
    string folder_id = 1 [(required) = true, (length) = "<=50"];
    map<string, string> labels = 2 [(size) = "<=64", (length) = "<=63", (pattern) = "[-_0-9a-z]*", (map_key).length = "<=63", (map_key).pattern = "[a-z][-_0-9a-z]*"];
    string domain = 3 [(required) = true, (length) = "1-253"];
    string primary_certificate_id = 4 [(length) = "<=50"];
    string description = 5;
    repeated reference.Reference references = 100;
}

message DeleteDomainRequest {
    string domain_id = 1 [(required) = true, (length) = "<=50"];
}

message UpdateDomainRequest {
    string domain_id = 1 [(required) = true, (length) = "<=50"];
    google.protobuf.FieldMask update_mask = 2;
    map<string, string> labels = 3 [(size) = "<=64", (length) = "<=63", (pattern) = "[-_0-9a-z]*", (map_key).length = "<=63", (map_key).pattern = "[a-z][-_0-9a-z]*"];
    string description = 4;
}

message SetPrimaryCertificateRequest {
    string domain_id = 1 [(required) = true, (length) = "<=50"];
    string certificate_id = 4 [(length) = "<=50"];
}

message CreateDomainMetadata {
    string domain_id = 1;
}

message UpdateDomainMetadata {
    string domain_id = 1;
}

message SetPrimaryCertificateMetadata {
    string domain_id = 1;
}

message DeleteDomainMetadata {
    string domain_id = 1;
}

message ListDomainReferencesRequest {
    string domain_id = 1 [(required) = true, (length) = "<=50"];

    int64 page_size = 2 [(value) = "0-1000"];
    string page_token = 3 [(length) = "<=100"];
}

message ListDomainReferencesResponse {
    repeated reference.Reference references = 1;
    string next_page_token = 2;
}

message UpdateDomainReferencesRequest {
    string domain_id = 1 [(required) = true, (length) = "<=50"];
    repeated reference.Reference reference_additions = 2;
    repeated reference.Reference reference_deletions = 3;
}

message UpdateDomainReferencesMetadata {
    string domain_id = 1;
}

message ListDomainOperationsRequest {
    string domain_id = 1 [(required) = true, (length) = "<=50"];
    int64 page_size = 2 [(value) = "<=1000"];
    string page_token = 3 [(length) = "<=100"];
}

message ListDomainOperationsResponse {
    repeated operation.Operation operations = 1;
    string next_page_token = 2;
}
