syntax = "proto3";

package yandex.cloud.priv.k8s.v1.marketplace.console;

import "yandex/cloud/api/operation.proto";
import "yandex/cloud/priv/operation/operation.proto";
import "yandex/cloud/priv/validation.proto";
import "yandex/cloud/priv/console/v1/form.proto";
import "yandex/cloud/priv/sensitive.proto";

option go_package = "a.yandex-team.ru/cloud/bitbucket/private-api/yandex/cloud/priv/k8s/v1/marketplace/console;console";
option java_outer_classname = "PCMKMPHRS";

service HelmReleaseService {
    rpc GetInstallForm (InstallFormRequest) returns (yandex.cloud.priv.console.v1.FormResponse) {
    }

    rpc Install (InstallReleaseRequest) returns (operation.Operation) {
        option (yandex.cloud.api.operation) = {
          metadata: "InstallReleaseMetadata"
          response: "Release"
        };
    }

    rpc GetUpdateForm(UpdateFormRequest) returns (yandex.cloud.priv.console.v1.FormResponse) {
    }

    rpc Update (UpdateReleaseRequest) returns (operation.Operation) {
        option (yandex.cloud.api.operation) = {
          metadata: "UpdateReleaseMetadata"
          response: "Release"
        };
    }
}

message InstallFormRequest {
    string cluster_id = 1 [(required) = true];
}

message InstallReleaseRequest {
    string cluster_id = 1 [(required) = true];
    // Deprecated; use product_version_id instead
    string product_id = 2;
    string product_version_id = 4;
    string form_json = 3 [(required) = true, (sensitive) = true];
}

message InstallReleaseMetadata {
    string cluster_id = 1;
    // Deprecated; to be replaced with product_version_id
    string product_id = 2;
    string product_version_id = 4;
    string release_id = 3;
}

message UpdateFormRequest {
    string release_id = 1 [(required) = true];
}

message UpdateReleaseRequest {
    string release_id = 1 [(required) = true];
    string product_version_id = 2;
    string form_json = 3 [(required) = true, (sensitive) = true];
}

message UpdateReleaseMetadata {
    string release_id = 1;
    string product_version_id = 2;
}
