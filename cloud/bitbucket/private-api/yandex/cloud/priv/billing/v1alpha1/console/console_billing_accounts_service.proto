syntax = "proto3";

package yandex.cloud.priv.billing.v1alpha1;

import "google/api/annotations.proto";
import "yandex/cloud/api/tools/options.proto";
import "yandex/cloud/priv/validation.proto";
import "yandex/cloud/priv/billing/v1alpha1/billing_account.proto";
import "yandex/cloud/priv/billing/v1alpha1/binding.proto";
import "yandex/cloud/priv/billing/v1alpha1/card_payment_method.proto";
import "yandex/cloud/priv/billing/v1alpha1/subaccount_person_data.proto";
import "yandex/cloud/priv/billing/v1alpha1/person.proto";
import "yandex/cloud/priv/billing/v1alpha1/cloud.proto";
import "yandex/cloud/priv/billing/v1alpha1/subject.proto";
import "yandex/cloud/priv/billing/v1alpha1/cloud_usage_report.proto";
import "yandex/cloud/priv/billing/v1alpha1/sku_usage_report.proto";
import "yandex/cloud/priv/billing/v1alpha1/service_usage_report.proto";
import "yandex/cloud/priv/billing/v1alpha1/subaccount_report.proto";
import "yandex/cloud/priv/billing/v1alpha1/billing_account_usage_report.proto";
import "yandex/cloud/priv/billing/v1alpha1/monetary_grant.proto";
import "yandex/cloud/priv/billing/v1alpha1/subaccount.proto";
import "yandex/cloud/priv/billing/v1alpha1/invoice.proto";
import "yandex/cloud/priv/billing/v1alpha1/var_discount_total.proto";
import "yandex/cloud/priv/operation/operation.proto";
import "yandex/cloud/api/operation.proto";
import "yandex/cloud/priv/billing/v1alpha1/access_binding.proto";
import "yandex/cloud/priv/billing/v1alpha1/billing_user_info.proto";
import "yandex/cloud/priv/billing/v1alpha1/transaction.proto";
import "yandex/cloud/priv/billing/v1alpha1/usage_meta.proto";

option go_package = "a.yandex-team.ru/cloud/bitbucket/private-api/yandex/cloud/priv/billing/v1alpha1/console;billing";

service ConsoleBillingAccountsService {

    rpc ListBillingAccounts (FilterRequest) returns (BillingAccountList) {
        option (google.api.http) = { get: "/billing/v1alpha1/console/billingAccounts" };
    }

    rpc GetBillingAccountsDashboard (DashboardFilterRequest) returns (DashboardResponse) {
        option (google.api.http) = { get: "/billing/v1alpha1/console/dashboard" };
    }

    rpc GetBillingAccount (InfoRequest) returns (BillingAccount) {
        option (google.api.http) = { get: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}" };
    }

    rpc SetPaidBillingAccount (BillingAccountIDRequest) returns (IDResponse) {
        option (google.api.http) = { post: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}:setPaid" body: "*"};
    }

    rpc CreateBillingAccount (CompoundCreateRequest) returns (operation.Operation) {
        option (yandex.cloud.api.operation) = {
            metadata: "BillingAccountOperationMetadata"
            response: "BillingAccount"
        };
        option (google.api.http) = { post: "/billing/v1alpha1/console/billingAccounts/createCompound" body: "*"};
    }

    rpc CreateBillingAccountV2 (CompoundCreateRequestV2) returns (operation.Operation) {
        option (yandex.cloud.api.operation) = {
            metadata: "BillingAccountOperationMetadata"
            response: "BillingAccount"
        };
        option (google.api.http) = { post: "/billing/v1alpha1/console/billingAccounts/createCompoundV2" body: "*"};
    }
    rpc PrecheckBillingAccountV2 (CompoundCreateRequestV2) returns (PrecheckResponse) {
        option (google.api.http) = { post: "/billing/v1alpha1/console/billingAccounts/precheckCompoundV2" body: "*"};
    }

    rpc GetBillingAccountClouds (BillingAccountIDRequest) returns (CloudList) {
        option (google.api.http) = { get: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}/clouds"};
    }

    rpc ListAccessBindings (BillingAccountIDRequest) returns (ListAccessBindingsResponse) {
        option (google.api.http) = { get: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}:listAccessBindings"};
    }

    rpc ListUsers (BillingAccountIDRequest) returns (ListUsersResponse) {
        option (google.api.http) = { get: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}:listUsers"};
    }

    rpc UpdateAccessBinding (UpdateAccessBindingRequest) returns (ListAccessBindingsResponse) {
        option (google.api.http) = { post: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}:updateAccessBinding" body: "*"};
        option (yandex.cloud.api.tools.method).lint_skip.http_verb = true;
    }

    rpc UpdateAccessBindings (UpdateAccessBindingsRequest) returns (ListAccessBindingsResponse) {
        option (google.api.http) = { post: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}:updateAccessBindings" body: "*"};
        option (yandex.cloud.api.tools.method).lint_skip.http_verb = true;
    }

    rpc ListRoles (Empty) returns (ListRolesResponse) {
        option (google.api.http) = { get: "/billing/v1alpha1/console/billingAccounts:listRoles"};
    }

    rpc BindCard (BindPaymentCard) returns (CardPaymentMethod) {
        option (google.api.http) = { post: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}:bindCard" body: "*"};
    }

    rpc GetCard (BillingAccountIDRequest) returns (CardPaymentMethod) {
        option (google.api.http) = { get: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}:card"};
    }

    rpc MakeCardPayment (MakePayment) returns (operation.Operation) {
        option (google.api.http) = { post: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}:cardPayment" body: "*"};
        option (yandex.cloud.api.operation) = {
            metadata: "CardPaymentOperationMetadata"
            response: "Transaction"
        };
    }

    rpc MakeCardPayment3ds (MakePayment) returns (operation.Operation) {
        option (google.api.http) = { post: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}:cardPayment3ds" body: "*"};
        option (yandex.cloud.api.operation) = {
            metadata: "CardPaymentOperationMetadata"
            response: "Transaction"
        };
    }

    rpc MakeInvoicePayment (MakePayment) returns (operation.Operation) {
        option (google.api.http) = { post: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}:invoicePayment" body: "*"};
        option (yandex.cloud.api.operation) = {
            metadata: "InvoicePaymentOperationMetadata"
            response: "Invoice"
        };
    }

    rpc GetAccountTransaction (GetAccountTransactionRequest) returns (Transaction) {
        option (google.api.http) = { get: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}/transactions/{transaction_id}"};
    }

    rpc ListAccountTransactions (ListAccountTransactionsRequest) returns (TransactionsList) {
        option (google.api.http) = { get: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}/transactions"};
    }

    rpc GetAccountInvoice (GetAccountInvoiceRequest) returns (Invoice) {
        option (google.api.http) = { get: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}/invoices/{invoice_id}"};
    }

    rpc ListAccountInvoices (ListAccountInvoicesRequest) returns (InvoicesList) {
        option (google.api.http) = { get: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}/invoices"};
    }

    // actually returns bytes stream
    rpc DownloadInvoicePDF (GetAccountInvoiceRequest) returns (Empty) {
        option (google.api.http) = { get: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}/invoices/{invoice_id}:pdf"};
        option (yandex.cloud.api.tools.method).lint_skip.http_verb = true;
    }

    rpc ListSubaccounts (ListSubaccountsRequest) returns (ListSubaccountsResponse) {
        option (google.api.http) = { get: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}:listSubaccounts"};
    }

    rpc ActivateSubaccount (BillingAccountIDRequest) returns (operation.Operation) {
        option (google.api.http) = { post: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}:activate" body: "*"};
        option (yandex.cloud.api.operation) = {
            metadata: "SubaccountOperationMetadata"
            response: "BillingAccount"
        };
    }

    rpc SuspendSubaccount (BillingAccountIDRequest) returns (operation.Operation) {
        option (google.api.http) = { post: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}:suspend" body: "*"};
        option (yandex.cloud.api.operation) = {
            metadata: "SubaccountOperationMetadata"
            response: "BillingAccount"
        };
    }

    rpc AcceptSubaccount (AcceptSubaccountRequest) returns (operation.Operation) {
        option (google.api.http) = { post: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}:acceptSubaccount" body: "*"};
        option (yandex.cloud.api.operation) = {
            metadata: "SubaccountOperationMetadata"
            response: "BillingAccount"
        };
    }

    rpc RejectSubaccount (BillingAccountIDRequest) returns (operation.Operation) {
        option (google.api.http) = { post: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}:rejectSubaccount" body: "*"};
        option (yandex.cloud.api.operation) = {
            metadata: "SubaccountOperationMetadata"
            response: "BillingAccount"
        };
    }

    rpc AcceptSubaccountInvite (AcceptSubaccountInviteRequest) returns (operation.Operation) {
        option (google.api.http) = { post: "/billing/v1alpha1/console/billingAccounts:acceptSubaccount" body: "*"};
        option (yandex.cloud.api.operation) = {
            metadata: "SubaccountOperationMetadata"
            response: "BillingAccount"
        };
    }

    rpc CreateSubaccount (CreateSubaccountRequest) returns (operation.Operation) {
        option (google.api.http) = { post: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}:createSubaccount" body: "*"};
        option (yandex.cloud.api.operation) = {
            metadata: "SubaccountOperationMetadata"
            response: "BillingAccount"
        };
    }
    rpc ListMonetaryGrants (ListAccountGrantsConsoleRequest) returns (MonetaryGrantList) {
        option (google.api.http) = { get: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}/monetaryGrants"};
    }

    rpc GetUsageMeta (BillingAccountIDRequest) returns (UsageMetaResponse) {
        option (google.api.http) = { get: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}/usageMeta"};
    }
    rpc GetCloudUsageReports (UsageReportRequest) returns (CloudUsageReport) {
        option (google.api.http) = { post: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}/cloudUsageReports" body: "*"};
        option (yandex.cloud.api.tools.method).lint_skip.http_verb = true;
    }
    rpc GetSkuUsageReports (UsageReportRequest) returns (SkuUsageReport) {
        option (google.api.http) = { post: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}/skuUsageReports" body: "*"};
        option (yandex.cloud.api.tools.method).lint_skip.http_verb = true;
    }
    rpc GetServiceUsageReports (UsageReportRequest) returns (ServiceUsageReport) {
        option (google.api.http) = { post: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}/serviceUsageReports" body: "*"};
        option (yandex.cloud.api.tools.method).lint_skip.http_verb = true;
    }
    rpc GetBillingAccountUsageReports (UsageReportRequest) returns (BillingAccountUsageReport) {
        option (google.api.http) = { post: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}/billingAccountUsageReports" body: "*"};
        option (yandex.cloud.api.tools.method).lint_skip.http_verb = true;
    }
    rpc GetBillingAccountUsageReport (UsageReportRequest) returns (BillingAccountUsageReportResponse) {
        option (google.api.http) = { post: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}/billingAccountUsageReport" body: "*"};
        option (yandex.cloud.api.tools.method).lint_skip.http_verb = true;
    }
    rpc GetCloudUsageReport (UsageReportRequest) returns (CloudUsageReportResponse) {
        option (google.api.http) = { post: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}/cloudUsageReport" body: "*"};
        option (yandex.cloud.api.tools.method).lint_skip.http_verb = true;
    }
    rpc GetSkuUsageReport (UsageReportRequest) returns (SkuUsageReportResponse) {
        option (google.api.http) = { post: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}/skuUsageReport" body: "*"};
        option (yandex.cloud.api.tools.method).lint_skip.http_verb = true;
    }
    rpc GetServiceUsageReport (UsageReportRequest) returns (ServiceUsageReportResponse) {
        option (google.api.http) = { post: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}/serviceUsageReport" body: "*"};
        option (yandex.cloud.api.tools.method).lint_skip.http_verb = true;
    }
    rpc GetVarDiscountReport (VarDiscountReportRequest) returns (VarDiscountReport) {
        option (google.api.http) = { post: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}/varDiscountReport" body: "*"};
        option (yandex.cloud.api.tools.method).lint_skip.http_verb = true;
    }
    rpc ServiceInstanceBindings (BillingAccountBindingsConsoleRequest) returns (BindingsListConsoleResponse) {
        option (google.api.http) = { get: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}/serviceInstanceBindings"};
        option (yandex.cloud.api.tools.method).lint_skip.http_verb = true;
    }
    rpc UpdatePerson (UpdatePersonRequest) returns (operation.Operation) {
        option (yandex.cloud.api.operation) = {
            metadata: "PersonOperationMetadata"
            response: "IDResponse"
        };
        option (google.api.http) = { post: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}:updatePerson" body: "*"};
        option (yandex.cloud.api.tools.method).lint_skip.http_verb = true;
    }
}

message Empty {
}

message FilterRequest {
    bool is_var = 1;
}

message DashboardFilterRequest {
    bool is_var = 1;
    string page_token = 2;
    int64 page_size = 3 [(value) = "0-1000"];
    bool show_grants = 4;
    bool show_clouds = 5;
    bool is_referrer = 6;

}

message DashboardResponse {
    repeated DashboardView billing_accounts = 1;
    string next_page_token = 2;
}
message BillingAccountList {
    repeated BillingAccount billing_accounts = 1;
}

message InfoRequest {
    enum View {
        VIEW_UNSPECIFIED = 0;
        FULL = 1;
        SHORT = 2;
    }
    string billing_account_id = 1;
    View view = 2;
}

message BillingAccountIDRequest {
    string billing_account_id = 1;
}

message ListAccountGrantsConsoleRequest {
    string billing_account_id = 1;
    bool expired = 2;
}

message IDResponse {
    string id = 1;
}

message CompoundCreateRequest {
    message PersonData {
        BillingAccount.PersonType type = 1;
        oneof data {
            Company company = 2;
            Individual individual = 3;
            // here be nonresidents
        }
    }
    PersonData person_data = 1;
    string cloud_id = 2;
    string card_id = 3;
    //    string remote_addr = 4; actually we take it from headers
    // string billing_account_id = 5; we generate it ourselves
    string antifraud_fingerprint = 6;
    string yandexuid = 7;
}

message CompoundCreateRequestV2 {
    message PersonData {
        BillingAccount.PersonType type = 1;
        oneof data {
            Company company = 2;
            Individual individual = 3;
            // Nonres & KZ?
        }
    }
    PersonData person_data = 1;
    string cloud_id = 2;
    string card_id = 3;
//    string remote_addr = 4; actually we take it from headers
    // string billing_account_id = 5; we generate it ourselves
    string phone = 6;
    string email = 7;
    string antifraud_fingerprint = 8;
    string yandexuid = 9;
}


message CloudList {
    repeated Cloud clouds = 1;
}

message BillingAccountOperationMetadata {
    string id = 1;
}

message ListAccessBindingsResponse {
    repeated AccessBinding access_bindings = 1;
}

message ListUsersResponse {
    repeated BillingUserInfo user = 1;
}

message UpdateAccessBindingRequest {
    string action = 1;
    Subject subject = 2;
    string role_id = 3;
    string billing_account_id = 4;
}

message UpdateAccessBindingsRequest {
    message AccessBindingDelta {
        string action = 1;
        string role_id = 2;
        Subject subject = 3;
    }
    string billing_account_id = 1;
    repeated AccessBindingDelta access_binding_deltas = 2;
}

message ListRolesResponse {
    repeated string roles = 1;
}

message BindPaymentCard {
    string billing_account_id = 1;
    string card_id = 2;
}

message MakePayment {
    string billing_account_id = 1;
    int64 amount = 2;
}

message CardPaymentOperationMetadata {
    string type = 1;
    string transaction_id = 2;
    string payment_url = 3;
}

message InvoicePaymentOperationMetadata {
    string type = 1;
    string invoice_id = 2;
}

message GetAccountTransactionRequest {
    string billing_account_id = 1;
    string transaction_id = 2;
}

message ListAccountTransactionsRequest {
    string billing_account_id = 1;
    string page_token = 2;
}

message TransactionsList {
    repeated Transaction transactions = 1;
}

message GetAccountInvoiceRequest {
    string billing_account_id = 1;
    string invoice_id = 2;
}

message ListAccountInvoicesRequest {
    string billing_account_id = 1;
    string page_token = 2;
}

message InvoicesList {
    repeated Invoice invoices = 1;
}

message ListSubaccountsRequest {
    string billing_account_id = 1;
    bool verbose = 2;
}

message ListSubaccountsResponse {
    repeated Subaccount subaccounts = 1;
}

message SubaccountOperationMetadata {
    string type = 1; // "subaccounts.accept",
    // "subaccounts.create",
    // "subaccounts.suspend",
    // "subaccounts.activate",
    // "subaccounts.reject"

    string master_account_id = 2;
    string subaccount_id = 3;
}

message AcceptSubaccountRequest {
    string billing_account_id = 1;
    bool promote_cloud_access = 2;
}

message AcceptSubaccountInviteRequest {
    string invite_code = 1;
    bool promote_cloud_access = 2;
}

message CreateSubaccountRequest {
    string billing_account_id = 1;
    string name = 2;
    string email = 3;
    SubaccountPersonData data = 4;
}

message MonetaryGrantList {
    string next_page_token = 1;
    repeated MonetaryGrant monetary_grants = 2;
}

message UsageMetaResponse {
    UsageMeta usage_meta = 1;
}

message UsageReportRequest {
    string billing_account_id = 1;
    string start_date = 2;
    string end_date = 3;
    repeated string cloud_ids = 4;
    repeated string sku_ids = 5;
}

message BillingAccountUsageReportResponse {
    BillingAccountUsageReport usage_report = 1;
}

message SkuUsageReportResponse {
    SkuUsageReport usage_report = 1;
}
message ServiceUsageReportResponse {
    ServiceUsageReport usage_report = 1;
}
message CloudUsageReportResponse {
    CloudUsageReport usage_report = 1;
}

message VarDiscountReport {
    message VarDiscountMonthlyReport {
        VarDiscountTotal total_report = 1;
        map<string, SubaccountReport> subaccount_reports = 2;
    }
    VarDiscountTotal total_report = 1;
    map<string, VarDiscountMonthlyReport> monthly_reports = 2;
}

message VarDiscountReportRequest {
    string billing_account_id = 1;
    string start_date = 2;
    string end_date = 3;
    repeated string subaccount_ids = 4;
}

message BillingAccountBindingsConsoleRequest {
    string billing_account_id = 1;
    string page_size = 2;
    string page_token = 3;
}

message BindingsListConsoleResponse {
    repeated BindingResponse binding = 1;
    string next_page_token = 2;
}

message UpdatePersonRequest {
    string billing_account_id = 1;
    Person person_data = 2;
}
