syntax = "proto3";

package yandex.cloud.priv.billing.v1alpha1;

import "google/api/annotations.proto";
import "google/protobuf/timestamp.proto";

import "yandex/cloud/api/operation.proto";
import "yandex/cloud/priv/operation/operation.proto";
import "yandex/cloud/priv/billing/v1alpha1/light_metric.proto";

option go_package = "a.yandex-team.ru/cloud/bitbucket/private-api/yandex/cloud/priv/billing/v1alpha1/console;billing";

service ConsoleCommittedUseDiscountService {
    rpc ListCommittedUseDiscounts (ListBillingAccountCommittedUseDiscountsRequest) returns (BillingAccountCommittedUseDiscountListResponse) {
        option (google.api.http) = { get: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}:listCommittedUseDiscounts"};
    }
    rpc ResolveCudTemplates (ResolveBillingAccountCudTemplateRequest) returns (BillingAccountCudTemplateListResponse) {
        option (google.api.http) = { post: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}:resolveCudTemplates" body: "*"};
    }
    rpc BatchCalculateCudTemplateCost (BatchCalculateBillingAccountCudTemplateCostRequest) returns (BatchBillingAccountCudTemplateCostResponse) {
        option (google.api.http) = { post: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}:batchGetCommittedUseDiscountCost" body: "*" };
    }
    rpc BatchCreateCommittedUseDiscount (BatchCreateBillingAccountCommittedUseDiscountRequest) returns (operation.Operation) {
        option (google.api.http) = { post: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}:batchCreateCommittedUseDiscount" body: "*" };
        option (yandex.cloud.api.operation) = {
          metadata: "EmptyMetadata"
          response: "BatchCreateBillingAccountCommittedUseDiscountResponse"
        };
    }
}

message ListBillingAccountCommittedUseDiscountsRequest {
    string billing_account_id = 1;
}

message BillingAccountCommittedUseDiscountResponse {
    string id = 1;
    string billing_account_id = 2;
    string compensated_sku_id = 3;
    google.protobuf.Timestamp start_time = 4;
    google.protobuf.Timestamp end_time = 5;
    string purchase_unit = 6;
    int64 purchase_quantity = 7;
    string monthly_cost = 8;
    google.protobuf.Timestamp created_at = 9;
}

message BillingAccountCommittedUseDiscountListResponse {
    repeated BillingAccountCommittedUseDiscountResponse committed_use_discounts = 1;
}

message ResolveBillingAccountCudTemplateRequest {
    string billing_account_id = 1;
    repeated LightMetric metrics = 2;
}

message IntervalConstraint {
    int64 min = 1;
    int64 max = 2;
    int64 step = 3;
}

message BillingAccountCudTemplateConstraints {
    IntervalConstraint purchase_quantity = 1;
    IntervalConstraint timespan = 2;
}

message BillingAccountCudTemplate {
    string id = 1;
    string purchase_unit = 2;
    repeated int64 billed_timespans = 3;
    BillingAccountCudTemplateConstraints constraints = 4;
    string compensated_sku_id = 5;
}

message BillingAccountCudTemplateListResponse {
    repeated BillingAccountCudTemplate cud_templates = 1;
}

message GetBillingAccountCudTemplateCostRequest {
    string template_id = 1;
    int64 timespan = 2;
    int64 purchase_quantity = 3;
}

message BatchCalculateBillingAccountCudTemplateCostRequest {
    string billing_account_id = 1;
    repeated GetBillingAccountCudTemplateCostRequest cud_template_list = 2;
}

message CudTemplateCostResponse {
    string compensated_cost = 1;
    string billed_cost = 2;
    string discount = 3;
    string percentage_discount = 4;
}

message BillingAccountCudTemplateCostResponse {
    string template_id = 1;
    int64 timespan = 2;
    int64 purchase_quantity = 3;
    CudTemplateCostResponse monthly_cost = 4;
    CudTemplateCostResponse timespan_cost = 5;
}

message BatchBillingAccountCudTemplateCostResponse {
    repeated BillingAccountCudTemplateCostResponse cud_template_cost_list = 1;
}

message CreateBillingAccountCommittedUseDiscountRequest {
    string template_id = 2;
    string start_date = 3;
    string end_date = 4;
    int64 purchase_quantity = 5;
}

message BatchCreateBillingAccountCommittedUseDiscountRequest {
    string billing_account_id = 1;
    repeated CreateBillingAccountCommittedUseDiscountRequest cud_templates = 2;
}

message BatchCreateBillingAccountCommittedUseDiscountResponse {
    repeated string committed_use_discount_ids = 1;
}
