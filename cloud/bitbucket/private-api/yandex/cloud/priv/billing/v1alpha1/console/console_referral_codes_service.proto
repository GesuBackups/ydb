syntax = "proto3";

package yandex.cloud.priv.billing.v1alpha1;

import "google/api/annotations.proto";
import "yandex/cloud/api/tools/options.proto";
import "yandex/cloud/api/operation.proto";
import "yandex/cloud/priv/operation/operation.proto";

import "google/protobuf/timestamp.proto";

option go_package = "a.yandex-team.ru/cloud/bitbucket/private-api/yandex/cloud/priv/billing/v1alpha1/console;billing";

service ConsoleReferralCodeService {
  rpc ListReferralCodes (ListReferralCodesRequest) returns (ListReferralCodesResponse) {
    option (google.api.http) = { get: "/billing/v1alpha1/console/referrers/{referrer_id}/referralCodes"};
  }
  rpc GetReferrerStatus (GetReferrerStatusRequest) returns (ReferrerStatusResponse) {
    option (google.api.http) = { get: "/billing/v1alpha1/console/referrers/{referrer_id}/status"};
  }
  rpc GetReferralCode (GetReferralCodeRequest) returns (ReferralCodeInfoResponse) {
    option (google.api.http) = { get: "/billing/v1alpha1/console/referralCodes/{referral_code_id}"};
  }
  rpc CreateReferralCode (CreateReferralCodeRequest) returns (operation.Operation) {
    option (google.api.http) = { post: "/billing/v1alpha1/console/referrers/{referrer_id}/referralCodes" body: "*"};
    option (yandex.cloud.api.operation) = {
      metadata: "EmptyMetadata"
      response: "ReferralCodeResponse"
    };
  }
  rpc UpdateReferralCode (UpdateReferralCodeRequest) returns (operation.Operation) {
    option (google.api.http) = { post: "/billing/v1alpha1/console/referrers/{referrer_id}/referralCodes/{id}:update" body: "*"};
    option (yandex.cloud.api.tools.method).lint_skip.http_verb = true;
    option (yandex.cloud.api.operation) = {
      metadata: "EmptyMetadata"
      response: "ReferralCodeResponse"
    };
  }
  rpc WithdrawReferrerReward (WithdrawReferralRewardRequest) returns (operation.Operation) {
    option (google.api.http) = { post: "/billing/v1alpha1/console/referrers/{referrer_id}:withdraw" body: "*"};
    option (yandex.cloud.api.tools.method).lint_skip.http_verb = true;
    option (yandex.cloud.api.operation) = {
      metadata: "EmptyMetadata"
      response: "WithdrawalReferrerRewardResponse"
    };
  }
  rpc ListReferrerRewardWithdrawals (ListReferrerRewardWithdrawalsRequest)
      returns (ListReferrerRewardWithdrawalsResponse) {
    option (google.api.http) = { get: "/billing/v1alpha1/console/referrers/{referrer_id}/withdrawals"};
  }
}

message ListReferralCodesRequest {
  string referrer_id = 1;
}

message CreateReferralCodeRequest {
  string referrer_id = 1;
  string name = 2;

  enum State {
    STATE_UNSPECIFIED = 0;
    ACTIVE = 1;
    DISABLED = 2;
  }
  State state = 3;
}

message UpdateReferralCodeRequest {
  string id = 1;
  string referrer_id = 2;
  string name = 3;

  enum State {
    STATE_UNSPECIFIED = 0;
    ACTIVE = 1;
    DISABLED = 2;
  }
  State state = 4;
}

message ReferralCodeResponse {
  string id = 1;
  string billing_account_id = 2;
  string name = 3;

  enum State {
    STATE_UNSPECIFIED = 0;
    ACTIVE = 1;
    DISABLED = 2;
  }
  State state = 4;
  int64 activations = 5;
  int64 registrations = 6;
  google.protobuf.Timestamp created_at = 7;
}

message ListReferralCodesResponse {
  repeated  ReferralCodeResponse referral_codes = 1;
}

message GetReferralCodeRequest {
  string referral_code_id = 1;
}

message ReferralCodeInfoResponse {
  string id = 1;
  string billing_account_id = 2;
  string name = 3;

  enum State {
    STATE_UNSPECIFIED = 0;
    ACTIVE = 1;
    DISABLED = 2;
  }
  State state = 4;
  google.protobuf.Timestamp created_at = 5;

  string company_name = 6;
  string company_inn = 7;
}

enum ReferrerWithdrawType {
  REFERRER_WITHDRAW_TYPE_UNSPECIFIED = 0;
  GRANT = 1;
  CASH = 2;
}

message WithdrawReferralRewardRequest {
  string referrer_id = 1;
  ReferrerWithdrawType type = 2;
  double amount = 3;
}

message WithdrawalReferrerRewardResponse {
  string referrer_id = 1;
  ReferrerWithdrawType type = 2;
  double amount = 3;
  google.protobuf.Timestamp created_at = 4;
}

message ListReferrerRewardWithdrawalsRequest {
  string referrer_id = 1;
}

message ListReferrerRewardWithdrawalsResponse {
  repeated WithdrawalReferrerRewardResponse referrer_reward_withdrawals = 1;
}

message GetReferrerStatusRequest {
  string referrer_id = 1;
}

message ReferrerStatusResponse {
  string referrer_id = 1;
  double amount = 2;
  int64 activations = 3;
  int64 registrations = 4;
}
