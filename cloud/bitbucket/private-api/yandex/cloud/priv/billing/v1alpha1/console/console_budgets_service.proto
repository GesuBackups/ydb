syntax = "proto3";

package yandex.cloud.priv.billing.v1alpha1;

import "google/api/annotations.proto";
import "yandex/cloud/api/tools/options.proto";
import "yandex/cloud/api/operation.proto";
import "yandex/cloud/priv/operation/operation.proto";

option go_package = "a.yandex-team.ru/cloud/bitbucket/private-api/yandex/cloud/priv/billing/v1alpha1/console;billing";

service ConsoleBudgetsService {
  rpc ListBudgets (ListBudgetRequest) returns (ListBudgetResponse) {
    option (google.api.http) = { get: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}/budgets"};
  }

  rpc GetBudget (GetBudgetRequest) returns (BudgetResponse) {
    option (google.api.http) = { get: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}/budgets/{id}"};
  }

  rpc CreateBudget (CreateBudgetRequest) returns (operation.Operation) {
    option (google.api.http) = { post: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}/budgets" body: "*"};
    option (yandex.cloud.api.operation) = {
      metadata: "EmptyMetadata"
      response: "BudgetResponse"
    };
  }

  rpc UpdateBudget (UpdateBudgetRequest) returns (operation.Operation) {
    option (google.api.http) = { put: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}/budgets/{id}" body: "*"};
    option (yandex.cloud.api.tools.method).lint_skip.http_verb = true;
    option (yandex.cloud.api.operation) = {
      metadata: "EmptyMetadata"
      response: "BudgetResponse"
    };
  }

  rpc DeleteBudget (DeleteBudgetRequest) returns (operation.Operation) {
    option (google.api.http) = { delete: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}/budgets/{id}"};
    option (yandex.cloud.api.operation) = {
      metadata: "EmptyMetadata"
      response: "BudgetResponse"
    };
  }

  rpc GetBudgetNotifications (ListBudgetNotificationRequest) returns (ListBudgetNotificationResponse) {
    option (google.api.http) = { get: "/billing/v1alpha1/console/billingAccounts/{billing_account_id}/budgets/{budget_id}/notificationHistory"};
  }
}

message ListBudgetRequest {
  string billing_account_id = 1;
}

message CloudAndFolderPair {
  string cloud_id = 1;
  string folder_id = 2;
}

message BudgetFilterResponse {
  repeated CloudAndFolderPair cloud_and_folder_ids = 1;
  repeated string service_ids = 2;
}

message BudgetThresholdRuleResponse {
  double threshold = 1;

  enum ThresholdType {
    THRESHOLD_TYPE_UNSPECIFIED = 0;
    PERCENT = 1;
    AMOUNT = 2;
  }
  ThresholdType threshold_type = 2;
  repeated string notification_users = 3;
}

enum BudgetType {
  BUDGET_TYPE_UNSPECIFIED = 0;
  EXPENSE = 1;
  COST = 2;
}

enum BudgetState {
  BUDGET_STATE_UNSPECIFIED = 0;
  CREATING = 1;
  ACTIVE = 2;
  FINISHED = 3;
  DELETED = 4;
}

enum BudgetResetPeriod {
  BUDGET_RESET_PERIOD_UNSPECIFIED = 0;
  MONTHLY = 1;
  QUARTER = 2;
  ANNUALLY = 3;
  CUSTOM = 4;
}

message BudgetResponse {
  string id = 1;
  string billing_account_id = 2;
  string name = 3;
  BudgetState state = 4;
  BudgetResetPeriod reset_period = 5;
  string last_calculated_period = 6;
  int64 start_date = 7;
  int64 expiration_date = 8;
  BudgetFilterResponse filter_info = 9;
  double budgeted_amount = 10;
  BudgetType budget_type = 11;
  repeated BudgetThresholdRuleResponse threshold_rules = 12;
  repeated string notification_users = 13;
  bool use_in_cloud_function = 14;
  double current_amount = 15;
  string created_by = 16;
  int64 created_at = 17;
  int64 updated_at = 18;
}

message ListBudgetResponse {
  string next_page_token = 1;
  repeated BudgetResponse budgets = 2;
}

message GetBudgetRequest {
  string billing_account_id = 1;
  string id = 2;
}

message CreateBudgetRequest {
  string billing_account_id = 1;
  string name = 2;
  BudgetResetPeriod reset_period = 3;
  int64 start_date = 4;
  int64 expiration_date = 5;
  BudgetFilterResponse filter_info = 6;
  double budgeted_amount = 7;
  BudgetType budget_type = 8;
  repeated BudgetThresholdRuleResponse threshold_rules = 9;
  repeated string notification_users = 10;
  bool use_in_cloud_function = 11;
}

message UpdateBudgetRequest {
  string id = 1;
  string billing_account_id = 2;
  string name = 3;
  BudgetResetPeriod reset_period = 4;
  int64 start_date = 5;
  int64 expiration_date = 6;
  BudgetFilterResponse filter_info = 7;
  double budgeted_amount = 8;
  BudgetType budget_type = 9;
  repeated BudgetThresholdRuleResponse threshold_rules = 10;
  repeated string notification_users = 11;
  bool use_in_cloud_function = 12;
}

message DeleteBudgetRequest {
  string billing_account_id = 1;
  string id = 2;
}

message ListBudgetNotificationRequest {
  string billing_account_id = 1;
  string budget_id = 2;
}

message BudgetNotificationResponse {
  string id = 1;
  string billing_account_id = 2;
  string budget_id = 3;
  int64 alert_time = 4;
  string notification_period = 5;
  double threshold_amount = 6;
  BudgetThresholdRuleResponse threshold_rule = 7;
  repeated string notification_emails = 8;
  bool use_in_cloud_function = 9;
}

message ListBudgetNotificationResponse {
  string next_page_token = 1;
  repeated BudgetNotificationResponse budget_notifications = 2;
}
