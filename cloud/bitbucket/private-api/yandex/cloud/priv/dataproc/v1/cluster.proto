syntax = "proto3";

package yandex.cloud.priv.dataproc.v1;

import "google/protobuf/timestamp.proto";
import "yandex/cloud/api/tools/options.proto";
import "yandex/cloud/priv/dataproc/v1/common.proto";

option go_package = "a.yandex-team.ru/cloud/bitbucket/private-api/yandex/cloud/priv/dataproc/v1;dataproc";
option java_outer_classname = "PHC";

// Hadoop cluster.
message Cluster {
  enum Status {
    option (cloud.api.tools.enumeration).lint_skip.unspecified_value = true;
    STATUS_UNKNOWN = 0; // Cluster status is unknown
    CREATING = 1; // Cluster is being created
    RUNNING = 2; // Cluster is running
    ERROR = 3; // Cluster failed
    STOPPING = 4; // Cluster stopping
    STOPPED = 5; // Cluster stopped
    STARTING = 6; // Cluster starting
  }

  // Required. Unique ID of the Hadoop cluster.
  // This ID is assigned by MDB in the process of creating a Hadoop cluster.
  string id = 1;

  // ID of the folder that the Hadoop cluster belongs to.
  string folder_id = 2;

  // The time when the Hadoop cluster was created.
  google.protobuf.Timestamp created_at = 3;

  // Name of the Hadoop cluster.
  // The name is unique within the folder. 1-64 characters long.
  string name = 4;

  // Description of the Hadoop cluster. 0-256 characters long.
  string description = 5;

  map<string, string> labels = 6;

  // Monitoring systems relevant to the Hadoop cluster.
  repeated Monitoring monitoring = 7;

  // Configuration of the Hadoop cluster.
  ClusterConfig config = 8;

  // Aggregated cluster health.
  Health health = 9;

  // Cluster status.
  Status status = 10;

  // ID of the availability zone.
  string zone_id = 11;

  // ID of the service account for Dataproc manager agent.
  string service_account_id = 12;

  // Object storage bucket name for Dataproc jobs.
  string bucket = 13;

  // Whether UI Proxy feature is enabled.
  bool ui_proxy = 14;

  // User security groups
  repeated string security_group_ids = 15;

  // Host groups hosting VMs of the cluster.
  repeated string host_group_ids = 16;

  // Deletion Protection inhibits deletion of the cluster
  bool deletion_protection = 17;

  // ID of the cloud logging log group to write logs. If not set, default log group for the folder will be used.
  // To prevent logs from being sent to the cloud set cluster property dataproc:disable_cloud_logging = true
  string log_group_id = 18;
}

// Monitoring system.
message Monitoring {
  // Name of the monitoring system.
  string name = 1;

  // Description of the monitoring system.
  string description = 2;

  // Link to the monitoring system.
  string link = 3;
}

message HadoopConfig {
  enum Service {
    option (cloud.api.tools.enumeration).lint_skip.unspecified_value = true;
    SERVICE_UNSPECIFIED = 0;
    HDFS = 1;
    YARN = 2;
    MAPREDUCE = 3;
    HIVE = 4;
    TEZ = 5;
    ZOOKEEPER = 6;
    HBASE = 7;
    SQOOP = 8;
    FLUME = 9;
    SPARK = 10;
    ZEPPELIN = 11;
    OOZIE = 12;
    LIVY = 13;
  }

  // Set of used services in image (all if empty)
  repeated Service services = 1;

  // Properties passed to main node software
  // in key you need to use prefix: 'hdfs:dfs.hosts'
  map<string, string> properties = 2;

  // SSH-key to access cluster nodes
  repeated string ssh_public_keys = 3;

  // Set of init-actions
  repeated InitializationAction initialization_actions = 4;
}

message ClusterConfig {
  // Vesion of image for cluster provisioning
  string version_id = 1;

  // Hadoop specific options
  HadoopConfig hadoop = 2;
}

message InitializationAction {
  // URI of the executable file
  string uri = 1;

  // Arguments to the initialization action
  repeated string args = 2;

  // Execution timeout
  int64 timeout = 3;
}
