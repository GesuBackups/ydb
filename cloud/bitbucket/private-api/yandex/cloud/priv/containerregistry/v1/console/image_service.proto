syntax = "proto3";

package yandex.cloud.priv.containerregistry.v1.console;

import "yandex/cloud/priv/containerregistry/v1/console/image.proto";
import "yandex/cloud/priv/containerregistry/v1/console/repository.proto";
import "yandex/cloud/priv/operation/operation.proto";
import "yandex/cloud/priv/validation.proto";

option go_package = "a.yandex-team.ru/cloud/bitbucket/private-api/yandex/cloud/priv/containerregistry/v1/console;containerregistry_console";
option java_outer_classname = "PCIS";

service ImageService {

  rpc List (ListImagesRequest) returns (ListImagesResponse);

  rpc Get (GetImageRequest) returns (Image);

  rpc Delete (DeleteImageRequest) returns (DeleteImageResponse);

  rpc FindTags (FindTagsRequest) returns (FindTagsResponse);
}

message ListImagesRequest {
  string registry_id = 1 [(length) = "<=50"];
  string repository_prefix = 2 [(pattern) = "|[a-z0-9]+(?:[._-][a-z0-9]+)*(/([a-z0-9]+(?:[._-][a-z0-9]+)*))*"];

  int64 page_size = 3 [(value) = "0-1000"];
  string page_token = 4 [(length) = "<=100"];
  string order_by = 5 [(length) = "<=100"];
}

message ListImagesResponse {
  repeated Repository repositories = 1;
  repeated Image images = 2;
  string next_page_token = 3;
}

message GetImageRequest {
  string image_id = 1 [(required) = true, (length) = "<=50"];
}

message DeleteImageRequest {
  repeated string image_ids = 1 [(size) = ">0", (length) = "<=50"];
}

message DeleteImageResponse {
  repeated operation.Operation operations = 1;
}

message DeleteImageMetadata {
  string image_id = 1;
}

message FindTagsRequest {
  string repository_name = 1 [(required) = true, (pattern) = "|[a-z0-9]+(?:[._-][a-z0-9]+)*(/([a-z0-9]+(?:[._-][a-z0-9]+)*))+"];
  string tag_filter = 2;

  int64 page_size = 3 [(value) = "0-1000"];
}

message FindTagsResponse {
  repeated string tags = 1;
  bool has_more = 2;
}
