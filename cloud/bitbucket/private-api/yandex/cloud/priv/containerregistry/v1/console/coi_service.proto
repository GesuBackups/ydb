syntax = "proto3";

package yandex.cloud.priv.containerregistry.v1.console;

import "google/protobuf/empty.proto";

import "yandex/cloud/priv/validation.proto";
import "yandex/cloud/priv/containerregistry/v1/console/coi.proto";

option go_package = "a.yandex-team.ru/cloud/bitbucket/private-api/yandex/cloud/priv/containerregistry/v1/console;containerregistry_console";
option java_outer_classname = "PCOIS";

service COIService {

    /* convert ContainerSpec into string representation */
    rpc GenerateContainerSpec (GenerateContainerSpecRequest) returns (GenerateContainerSpecResponse);

    /* parse string representation of ContainerSpec */
    rpc ParseContainerSpec (ParseContainerSpecRequest) returns (ParseContainerSpecResponse);

    rpc GetLatestImage (google.protobuf.Empty) returns (GetLatestImageResponse);
    rpc GetLatestImageWithType (GetLatestImageRequest) returns (GetLatestImageResponse);
}

message GenerateContainerSpecRequest {
    string folder_id = 1 [(required) = true, (length) = "<=50"]; // folder ID to check access permissions
    DockerContainerDeclaration docker_container_declaration = 2;
}

message GenerateContainerSpecResponse {
    string docker_container_declaration = 1;
}

message ParseContainerSpecRequest {
    string folder_id = 1 [(required) = true, (length) = "<=50"]; // folder ID to check access permissions
    string docker_container_declaration = 2;
}

message ParseContainerSpecResponse {
    DockerContainerDeclaration docker_container_declaration = 1;
}

message GetLatestImageRequest {
  enum Type {
    TYPE_UNSPECIFIED = 0;
    NORMAL = 1;
    GPU = 2;
  }
  Type type = 1;
}

message GetLatestImageResponse {
    string image_id = 1;
}
