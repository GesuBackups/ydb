syntax = "proto3";

package yandex.cloud.priv.datatransfer.v1.endpoint;

option go_package = "a.yandex-team.ru/cloud/bitbucket/private-api/yandex/cloud/priv/datatransfer/v1/endpoint;tm_server_endpoint";

import "yandex/cloud/priv/datatransfer/v1/endpoint/common.proto";

enum LineSplitter {
    LINE_SPLITTER_UNSPECIFIED = 0;
    NEW_LINE = 1;
    NO_SPLITTER = 2;
}
message FieldList {
    // Fields
    repeated ColSchema fields = 2;
}
message DataSchema {
    oneof schema {
        // Field list
        FieldList fields = 2;
        // JSON Spec
        string json_fields = 1;
        // Logfeller Schema ID
        string logfeller_schema_id = 3;
    }
}
message ConvertRecordOptions {
    // Data format
    ParsingFormat format = 1;
    // Data scheme
    DataSchema data_schema = 3;
    // Add a column for missing keys
    // 
    // Keys that are missing from the data scheme will be added to the _rest column
    bool add_rest_column = 2;
}
message YDSSource {
    // Endpoint
    string endpoint = 20;
    // Database
    string database = 1;
    // Stream
    string stream = 2;
    // SA Account
    string service_account_id = 8;
    // Transformation rules
    // 
    // Transform data with custom Yandex Function
    DataTransformationOptions transformer = 5;
    // Conversion rules
    ConvertRecordOptions converter = 4;
    // ObjectStorage bucket for errors
    string object_storage_backup_bucket = 32;
    // Line splitter rule
    LineSplitter line_splitter = 17;
    ObjectStorageBackupMode backup_mode = 7;
}
