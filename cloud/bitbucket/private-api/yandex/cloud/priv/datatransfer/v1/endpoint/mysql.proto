syntax = "proto3";

package yandex.cloud.priv.datatransfer.v1.endpoint;

option go_package = "a.yandex-team.ru/cloud/bitbucket/private-api/yandex/cloud/priv/datatransfer/v1/endpoint;tm_server_endpoint";

import "yandex/cloud/priv/datatransfer/v1/endpoint/common.proto";

message OnPremiseMysql {
    // IP or FQDN of the host
    // 
    // IP or FQDN database host for making connection with source data base.
    string host = 1;
    repeated string hosts = 5;
    // Database port
    // 
    // Default: 3306.
    int64 port = 2;
    // CA certificate
    // 
    // X.509 certificate of the certificate authority which issued the MySQL server's
    // certificate, in PEM format. When CA certificate is specified TLS is used to
    // connect to the MySQL server.
    string ca_certificate = 3;
    // TLS mode
    // 
    // TLS settings for server connection. Disabled by default.
    TLSMode tls_mode = 6;
    // Network interface for endpoint
    // 
    // Default: public IPv4.
    string subnet_id = 4;
}
message MysqlConnection {
    oneof connection {
        // Managed cluster
        // 
        // Yandex.Cloud Managed MySQL cluster ID
        string mdb_cluster_id = 1;
        // On-premise
        // 
        // Connection options for on-premise MySQL
        OnPremiseMysql on_premise = 2;
    }
}
message MysqlDumpSteps {
    // Views
    // 
    // CREATE VIEW ...
    bool view = 1;
    // Routines
    // 
    // CREATE PROCEDURE ... ; CREATE FUNCTION ... ;
    bool routine = 2;
    // Triggers
    // 
    // CREATE TRIGGER ...
    bool trigger = 3;
}
message MysqlObjectTransferSettings {
    // Views
    // 
    // CREATE VIEW ...
    ObjectTransferStage view = 1;
    // Routines
    // 
    // CREATE PROCEDURE ... ; CREATE FUNCTION ... ;
    ObjectTransferStage routine = 2;
    // Triggers
    // 
    // CREATE TRIGGER ...
    ObjectTransferStage trigger = 3;
}
message MysqlSource {
    // Connection settings
    // 
    // Database connection settings
    MysqlConnection connection = 1;
    // Security groups
    repeated string security_groups = 14;
    // Database name
    // 
    // You can leave it empty, then it will be possible to transfer tables from several
    // databases at the same time from this source.
    string database = 2;
    // Database for service tables
    // 
    // Default: data source database. Here created technical tables (__tm_keeper,
    // __tm_gtid_keeper).
    string service_database = 15;
    // Username
    // 
    // User for database access.
    string user = 3;
    // Password
    // 
    // Password for database access.
    Secret password = 4;
    // Included tables
    // 
    // If none or empty list is presented, all tables are replicated. Set as regular
    // expression.
    repeated string include_tables = 6;
    repeated string include_tables_regex = 12;
    // Excluded tables
    // 
    // If none or empty list is presented, all tables are replicated. Set as regular
    // expression.
    repeated string exclude_tables = 7;
    repeated string exclude_tables_regex = 13;
    // Database timezone
    // 
    // Is used for parsing timestamps for saving source timezones. Accepts values from
    // IANA timezone database. Default: local timezone.
    string timezone = 8;
    // Schema migration on transfer activation
    // 
    // Choose schema parts, which will be created on the start of transfer process.
    MysqlDumpSteps pre_steps = 9;
    // Schema migration on transfer deactivation
    // 
    // Choose schema parts, which will be created on the end of transfer process.
    MysqlDumpSteps post_steps = 10;
    // Schema migration
    // 
    // Select database objects to be transferred during activation or deactivation.
    MysqlObjectTransferSettings object_transfer_settings = 11;
}
message MysqlTarget {
    // Connection settings
    // 
    // Database connection settings
    MysqlConnection connection = 1;
    // Security groups
    repeated string security_groups = 16;
    // Database name
    // 
    // Allowed to leave it empty, then the tables will be created in databases with the
    // same names as on the source. If this field is empty, then you must fill below db
    // schema for service table.
    string database = 2;
    // Username
    // 
    // User for database access.
    string user = 3;
    // Password
    // 
    // Password for database access.
    Secret password = 4;
    // sql_mode
    // 
    // Default: NO_AUTO_VALUE_ON_ZERO,NO_DIR_IN_CREATE,NO_ENGINE_SUBSTITUTION.
    string sql_mode = 5;
    // Disable constraints checks
    // 
    // Recommend to disable for increase replication speed, but if schema contain
    // cascading operations we don't recommend to disable. This option set
    // FOREIGN_KEY_CHECKS=0 and UNIQUE_CHECKS=0.
    bool skip_constraint_checks = 6;
    // Database timezone
    // 
    // Is used for parsing timestamps for saving source timezones. Accepts values from
    // IANA timezone database. Default: local timezone.
    string timezone = 7;
    // Cleanup policy
    // 
    // Cleanup policy for activate, reactivate and reupload processes. Default is
    // DISABLED.
    CleanupPolicy cleanup_policy = 8;
    string service_schema = 14;
    // Database schema for service table
    // 
    // Default: db name. Here created technical tables (__tm_keeper, __tm_gtid_keeper).
    string service_database = 15;
}
