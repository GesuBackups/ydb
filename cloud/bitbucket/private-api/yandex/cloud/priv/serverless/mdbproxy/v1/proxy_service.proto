syntax = "proto3";

package yandex.cloud.priv.serverless.mdbproxy.v1;

import "google/protobuf/field_mask.proto";
import "yandex/cloud/api/operation.proto";
import "yandex/cloud/priv/access/access.proto";
import "yandex/cloud/priv/serverless/mdbproxy/v1/proxy.proto";
import "yandex/cloud/priv/operation/operation.proto";
import "yandex/cloud/priv/validation.proto";

option go_package = "a.yandex-team.ru/cloud/bitbucket/private-api/yandex/cloud/priv/serverless/mdbproxy/v1;proxy";
option java_outer_classname = "PSDS";

service ProxyService {
    rpc Get (GetProxyRequest) returns (Proxy);

    rpc List (ListProxyRequest) returns (ListProxyResponse);

    rpc Create (CreateProxyRequest) returns (operation.Operation) {
        option (yandex.cloud.api.operation) = {
          metadata: "CreateProxyMetadata"
          response: "Proxy"
        };
    };

    rpc Update (UpdateProxyRequest) returns (operation.Operation) {
        option (yandex.cloud.api.operation) = {
          metadata: "UpdateProxyMetadata"
          response: "Proxy"
        };
    };

    rpc Delete (DeleteProxyRequest) returns (operation.Operation) {
        option (yandex.cloud.api.operation) = {
          metadata: "DeleteProxyMetadata"
          response: "google.protobuf.Empty"
        };
    };

    rpc ListOperations (ListProxyOperationsRequest) returns (ListProxyOperationsResponse);

    rpc ListAccessBindings (access.ListAccessBindingsRequest) returns (access.ListAccessBindingsResponse);

    rpc SetAccessBindings (access.SetAccessBindingsRequest) returns (operation.Operation) {
        option (yandex.cloud.api.operation) = {
          metadata: "access.SetAccessBindingsMetadata"
          response: "google.protobuf.Empty"
        };
    }

    rpc UpdateAccessBindings (access.UpdateAccessBindingsRequest) returns (operation.Operation) {
        option (yandex.cloud.api.operation) = {
          metadata: "access.UpdateAccessBindingsMetadata"
          response: "google.protobuf.Empty"
        };
    }

    rpc GetFolderStats (GetFolderStatsRequest) returns (FolderStats);
}

message GetProxyRequest {
    string proxy_id = 1 [(required) = true, (length) = "<=50"];
}

message ListProxyRequest {
    string folder_id = 1 [(required) = true, (length) = "<=50"];
    int64 page_size = 2 [(value) = "0-1000"];
    string page_token = 3 [(length) = "<=100"];
    string filter = 4 [(length) = "<=1000"];
}

message ListProxyResponse {
    repeated Proxy proxies = 1;
    string next_page_token = 2 [(length) = "<=100"];
}

message CreateProxyRequest {
    string folder_id = 1 [(required) = true];
    string name = 2 [(pattern) = "|[a-z][-a-z0-9]{1,61}[a-z0-9]"];
    string description = 3 [(length) = "<=256"];
    map<string, string> labels = 4 [(size) = "<=64", (length) = "<=63", (pattern) = "[-_./\\@0-9a-z]*", (map_key).length = "1-63", (map_key).pattern = "[a-z][-_./\\@0-9a-z]*"];
    Target target = 5 [(required) = true];
}

message CreateProxyMetadata {
    string proxy_id = 1 [(length) = "<=50"];
}

message UpdateProxyRequest {
    string proxy_id = 1 [(required) = true];
    google.protobuf.FieldMask update_mask = 2;

    string name = 3 [(pattern) = "|[a-z][-a-z0-9]{1,61}[a-z0-9]"];
    string description = 4 [(length) = "<=256"];
    map<string, string> labels = 5 [(size) = "<=64", (length) = "<=63", (pattern) = "[-_./\\@0-9a-z]*", (map_key).length = "1-63", (map_key).pattern = "[a-z][-_./\\@0-9a-z]*"];

    Target target = 6;
}

message UpdateProxyMetadata {
    string proxy_id = 1 [(required) = true, (length) = "<=50"];
}

message DeleteProxyRequest {
    string proxy_id = 1 [(required) = true, (length) = "<=50"];
}

message DeleteProxyMetadata {
    string proxy_id = 1 [(required) = true, (length) = "<=50"];
}

message ListProxyOperationsRequest {
    string proxy_id = 1 [(required) = true];
    int64 page_size = 2 [(value) = "0-1000"];
    string page_token = 3 [(length) = "<=100"];
    string filter = 4 [(length) = "<=1000"];
}

message ListProxyOperationsResponse {
    repeated operation.Operation operations = 1;
    string next_page_token = 2;
}

message GetFolderStatsRequest {
  string folder_id = 1 [(required) = true];
}

message FolderStats {
  int64 proxy_count = 1;
}
