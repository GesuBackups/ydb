syntax = "proto3";

package yandex.cloud.priv.microcosm.v1;

import "yandex/cloud/api/operation.proto";
import "yandex/cloud/priv/microcosm/v1/application.proto";
import "yandex/cloud/priv/validation.proto";


import "yandex/cloud/priv/operation/operation.proto";

option go_package = "a.yandex-team.ru/cloud/bitbucket/private-api/yandex/cloud/priv/microcosm/v1;microcosm";
option java_outer_classname = "PMICTS";

service ApplicationService {
  rpc Create(CreateApplicationRequest) returns (operation.Operation) {
    option (yandex.cloud.api.operation) = {
      metadata: "CreateApplicationMetadata"
      response: "Application"
    };
  };

  rpc Delete(DeleteApplicationRequest) returns (operation.Operation) {
    option (yandex.cloud.api.operation) = {
      metadata: "DeleteApplicationMetadata"
      response: "google.protobuf.Empty"
    };
  }

  rpc Get(GetApplicationRequest) returns (Application);

  rpc List(ListApplicationsRequest) returns (ListApplicationsResponse);

  rpc ListTemplates(ListApplicationTemplateRequest) returns (ListApplicationTemplateResponse);

  rpc ListResources(ListApplicationResourcesRequest) returns (ListApplicationResourcesResponse);
}

message CreateApplicationRequest {
  // ID of the folder to create a application in.
  // To get the folder ID, use a [yandex.cloud.resourcemanager.v1.FolderService.List] request.
  string folder_id = 1 [(required) = true];

  // ID of the application template to create application from.
  // To get the available template IDs, use a [ yandex.cloud.priv.microcosm.v1.ApplicationService.ListTemplates] request.
  string application_template_id = 2 [(required) = true];

  // ID of the service account. The service account will be used for all API calls
  // during application creation process. For more information, see [Service accounts](/docs/iam/concepts/users/service-accounts).
  // To get the service account ID, use a [yandex.cloud.iam.v1.ServiceAccountService.List] request.
  string service_account_id = 3 [(required) = true];

  // Name of the application.
  string name = 4 [(pattern) = "|[a-z]([-a-z0-9]{0,61}[a-z0-9])?"];

  // Description of the application.
  string description = 5 [(length) = "<=256"];

  // Resource labels as `key:value` pairs.
  map<string, string> labels = 6 [(priv.size) = "<=64", (length) = "<=63", (pattern) = "[-_./\\@0-9a-z]*", (map_key).length = "1-63", (map_key).pattern = "[a-z][-_./\\@0-9a-z]*"];

  // Application parameters as `key:value` pairs.
  map<string, string> parameters = 7;
}

message ListApplicationTemplateRequest {
  // The maximum number of results per page to return. If the number of available
  // results is larger than [page_size],
  // the service returns a [ListApplicationTemplateResponse.next_page_token]
  // that can be used to get the next page of results in subsequent list requests.
  int64 page_size = 1 [(value) = "0-1000"];

  // Page token. To get the next page of results,
  // set [page_token] to the [ListApplicationTemplateResponse.next_page_token]
  // returned by a previous list request.
  string page_token = 2 [(length) = "<=100"];
}

message ListApplicationTemplateResponse {
  // List of Applications.
  repeated ApplicationTemplate templates = 1;

  // This token allows you to get the next page of results for list requests. If the number of results
  // is larger than [ListApplicationTemplateRequest.page_size], use
  // [next_page_token] as the value
  // for the [ListApplicationTemplateRequest.page_token] query parameter
  // in the next list request. Each subsequent list request will have its own
  // [next_page_token] to continue paging through the results.
  string next_page_token = 2;
}

message CreateApplicationMetadata {
  // ID of the application that is being created
  string application_id = 1 [(required) = true, (length) = "<=50"];
}

message DeleteApplicationRequest {
  // ID of the application to delete
  string application_id = 1 [(required) = true, (length) = "<=50"];
}

message DeleteApplicationMetadata {
  // ID of the application
  string application_id = 1 [(length) = "<=50"];
}

message GetApplicationRequest {
  // ID of the application to return.
  string application_id = 1 [(required) = true, (length) = "<=50"];
}

message ListApplicationsRequest {
  // ID of the folder to list applications in.
  // To get the folder ID, use a [yandex.cloud.resourcemanager.v1.FolderService.List] request.
  string folder_id = 1 [(required) = true];

  // The maximum number of results per page to return. If the number of available
  // results is larger than [page_size],
  // the service returns a [ListApplicationsResponse.next_page_token]
  // that can be used to get the next page of results in subsequent list requests.
  int64 page_size = 2 [(value) = "<=1000"];

  // Page token. To get the next page of results,
  // set [page_token] to the [ListApplicationsResponse.next_page_token]
  // returned by a previous list request.
  string page_token = 3 [(length) = "<=100"];

  // A filter field for future compatibility, unsupported at the moment.
  string filter = 4 [(length) = "<=1000"];
}

message ListApplicationsResponse {
  // Applications for the specified folder.
  repeated Application applications = 1;

  // This token allows you to get the next page of results for list requests. If the number of results
  // is larger than [ListApplicationsRequest.page_size], use
  // [next_page_token] as the value
  // for the [ListApplicationsRequest.page_token] query parameter
  // in the next list request. Each subsequent list request will have its own
  // [next_page_token] to continue paging through the results.
  string next_page_token = 2;
}

message ListApplicationResourcesRequest {
  // ID of the Application resource to list resources for.
  string application_id = 1 [(required) = true, (length) = "<=50"];

  // The maximum number of results per page to return. If the number of available
  // results is larger than [page_size],
  // the service returns a [ListApplicationResourcesResponse.next_page_token]
  // that can be used to get the next page of results in subsequent list requests.
  int64 page_size = 2 [(value) = "<=1000"];

  // Page token. To get the next page of results,
  // set [page_token] to the [ListApplicationResourcesResponse.next_page_token]
  // returned by a previous list request.
  string page_token = 3 [(length) = "<=100"];
}

message ListApplicationResourcesResponse {
  // Resources list for the specified application.
  repeated ApplicationResource resources = 1;

  // This token allows you to get the next page of results for list requests. If the number of results
  // is larger than [ListApplicationResourcesRequest.page_size], use
  // [next_page_token] as the value
  // for the [ListApplicationResourcesRequest.page_token] query parameter
  // in the next list request. Each subsequent list request will have its own
  // [next_page_token] to continue paging through the results.
  string next_page_token = 2;
}
