syntax = "proto3";

package yandex.cloud.priv.vulnerabilityscanner.v1;

import "yandex/cloud/priv/validation.proto";
import "google/protobuf/timestamp.proto";

option go_package = "a.yandex-team.ru/cloud/bitbucket/private-api/yandex/cloud/priv/vulnerabilityscanner/v1;vulnerabilityscanner";
option java_outer_classname = "PVS";

message ScanResult {
    enum Status {
        STATUS_UNSPECIFIED = 0;
        RUNNING = 1;
        READY = 2;
        ERROR = 3;
    }

    string id = 1;
    ImageId image_id = 2;
    google.protobuf.Timestamp scanned_at = 3;
    Status status = 4;
    VulnerabilityStats vulnerabilities = 5;
    string error_message = 6;
}

message ContainerImage {
    string id = 1 [(required) = true];
    string name = 2 [(required) = true];
    string digest = 3 [(required) = true];
    string registry_id = 4 [(required) = true];
    string folder_id = 5 [(required) = true];
    string cloud_id = 6 [(required) = true];
    int64 compressed_size = 7 [(value)=">0"];
}

message ImageId {
    enum Type {
        TYPE_UNSPECIFIED = 0;
        CONTAINER = 1;
    }
    string external_image_id = 1 [(required) = true, (length) = "<=50"];
    Type type = 2 [(required) = true];
}

message VulnerabilityStats {
    int64 critical = 1;
    int64 high = 2;
    int64 medium = 3;
    int64 low = 4;
    int64 negligible = 5;
    int64 undefined = 6;
}

message Vulnerability {
    enum Severity {
        SEVERITY_UNSPECIFIED = 0;

        // Critical severity is a world-burning problem, exploitable for nearly all users.
        // Includes remote root privilege escalations, or massive data loss.
        CRITICAL = 1;

        // High severity is a real problem, exploitable for many users in a default installation.
        // Includes serious remote denial of services, local root privilege escalations, or data loss.
        HIGH = 2;

        // Medium severity is a real security problem, and is exploitable for many users.
        // Includes network daemon denial of service attacks, cross-site scripting, and gaining user privileges.
        // Updates should be made soon for this priority of issue.
        MEDIUM = 3;

        // Low severity is a security problem, but is hard to exploit due to environment, requires a user-assisted attack,
        // a small install base, or does very little damage. These tend to be included in security updates only when
        // higher priority issues require an update, or if many low priority issues have built up.
        LOW = 4;

        // Negligible severity is technically a security problem, but is only theoretical in nature, requires a very special situation,
        // has almost no install base, or does no real damage. These tend not to get backport from upstream,
        // and will likely not be included in security updates unless there is an easy fix and some other issue causes an update.
        NEGLIGIBLE = 5;

        // Unknown severity is either a security problem that has not been assigned to a priority yet or
        // a priority that our system did not recognize.
        UNDEFINED = 6;
    }

    Severity severity = 1;
    oneof vulnerability {
        option (exactly_one) = true;
        PackageVulnerability package = 2;
    }
}

message PackageVulnerability {
    string name = 1;
    string description = 2;
    string link = 3;
    string package = 4;
    string source = 5;
    string version = 6;
    string fixed_by = 7;
}
