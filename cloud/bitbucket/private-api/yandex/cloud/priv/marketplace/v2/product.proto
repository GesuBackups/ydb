syntax = "proto3";

package yandex.cloud.priv.marketplace.v2;

import "google/protobuf/timestamp.proto";
import "google/protobuf/any.proto";
import "yandex/cloud/priv/marketplace/v2/i18n.proto";
import "yandex/cloud/priv/marketplace/v2/common.proto";
import "yandex/cloud/priv/marketplace/v2/publisher.proto";
import "yandex/cloud/priv/marketplace/v2/sku_draft.proto";
import "yandex/cloud/priv/validation.proto";

option go_package = "a.yandex-team.ru/cloud/bitbucket/private-api/yandex/cloud/priv/marketplace/v2;marketplace";
option java_outer_classname = "PMP";

//Public entity representing product
message Product {
    string id = 1;
    string name = 2;
    string version_id = 3;
    string publisher_id = 4;
    Type type = 5;
    google.protobuf.Timestamp created_at = 6;
    google.protobuf.Timestamp updated_at = 7;
    repeated Reference related_products = 8;
    repeated string category_ids = 9;

    MarketingInfo marketing_info = 10;

    repeated TermsOfService terms_of_service = 11;
    Pricing pricing = 12;
    State state = 13;
    Restrictions restrictions = 14;

    oneof payload {
        ComputeImagePayload compute_image = 20;
        SaasPayload saas = 21;
    }

    message Reference {
        string product_id = 1;
        Type product_type = 2;
        ReferenceType reference_type = 3;
        ReferenceNecessityType necessity_type = 4;
        map<string, ProductReferenceTranslations> translations = 5;
    }

    message MarketingInfo {
        StorageObject logo_source = 1;
        map<string, ProductMarketingInfoTranslations> translations = 2;
    }

    message TermsOfService {
        TosType type = 1;
        map<string, TermsOfServiceTranslations> translations = 2;
        string url = 3;
    }

    message Pricing {
        repeated Sku skus = 1;
        PricingType type = 2;

        enum PricingType {
            PRICING_TYPE_UNSPECIFIED = 0;
            FREE = 1;
            BYOL = 2;
            HOURLY = 3;
            MONTHLY = 4;
        }
    }
    enum State {
        STATE_UNSPECIFIED = 0;
        REVIEWING = 1;
        ACTIVE = 2;
        DEPRECATED = 3;
        ERROR = 4;
    }

    enum Type {
        TYPE_UNSPECIFIED = 0;
        COMPUTE_IMAGE = 1;
        SAAS = 2;
        SUBSCRIPTION = 3;
        DATALENS_CONNECTOR = 4;
        DATALENS_TEMPLATE = 5;
        DATALENS_DATASET = 6;
        DATALENS_GEOLAYER = 7;
        TERRAFORM = 8;
        K8S = 9;
        FUNCTION = 10;
    }

    enum ReferenceType {
        REFERENCE_TYPE_UNSPECIFIED = 0;
        ADDITIONAL_PAYMENTS = 1;
    }

    enum ReferenceNecessityType {
        REFERENCE_NECESSITY_TYPE_UNSPECIFIED = 0;
        OPTIONAL = 1;
        OBLIGATORY = 2;
    }

    enum TosType {
        TOS_TYPE_UNSPECIFIED = 0;
        DEFAULT_TOS = 1;
        ADDITIONAL_FIRST_PARTY_TOS = 2;
        ADDITIONAL_THIRD_PARTY_TOS = 3;
    }

    message Restrictions {
        BillingAccountRequirements billing_account_requirements = 1;

        enum BillingAccountUsageType {
            BILLING_ACCOUNT_USAGE_TYPE_UNSPECIFIED = 0;
            SERVICE = 1;
            PAID = 2;
            TRIAL = 3;
        }

        message BillingAccountRequirements {
            repeated BillingAccountUsageType usage_state = 1;
        }
    }
}

message ProductReferenceTranslations {
    string title = 1;
}
message TermsOfServiceTranslations {
    string title = 1;
}

//Public entity representing product
message LocalizedProduct {
    string id = 1;
    string name = 2;
    string version_id = 3;
    LocalizedPublisher publisher = 4;
    Product.Type type = 5;
    google.protobuf.Timestamp created_at = 6;
    google.protobuf.Timestamp updated_at = 7;
    repeated Reference related_products = 9;
    repeated string category_ids = 10;

    ProductMarketingInfoTranslations marketing_info = 11;

    repeated TermsOfService terms_of_service = 12;
    Product.Pricing pricing = 13;
    Product.State state = 14;
    int64 rating = 15;
    Product.Restrictions restrictions = 16;

    ProductPayload payload = 17;

    message Reference {
        string product_id = 1;
        string title = 2;
        Product.ReferenceType reference_type = 3;
        Product.ReferenceNecessityType necessity_type = 4;
    }

    message TermsOfService {
        Product.TosType type = 1;
        string title = 2;
        string url = 3;
    }
}

message ProductMarketingInfoTranslations {
    string name = 1;
    string description = 2;
    string short_description = 3;
    repeated LocalizedLink links = 4;
    string logo = 5;
    string support = 6;
    string use_cases = 7;
}

message ProductPayload {
    oneof type {
        option (exactly_one) = true;
        ComputeImagePayload compute_image = 1;
        SaasPayload saas = 2;
        DatalensGeolayerPayload datalens_geolayer = 3;
        DatalensDatasetPayload datalens_dataset = 4;
        DatalensConnectorPayload datalens_connector = 5;
        DatalensTemplatePayload datalens_template = 6;
    }
}

message ProductSource {
    oneof type {
        option (exactly_one) = true;
        ComputeImageSource compute_image = 1;
        SaasSource saas = 2;
        DatalensGeolayerSource datalens_geolayer = 3;
        DatalensDatasetSource datalens_dataset = 4;
        DatalensConnectorSource datalens_connector = 5;
        DatalensTemplateSource datalens_template = 6;
    }
}


message ComputeImagePayload {
    string image_id = 1;
    string folder_id = 2;
    ResourceSpec resource_spec = 3;
    string form_id = 4;
    PackageInfo package_info = 5;

    message ResourceSpec {
        ResourceIntervalRestriction cpu = 1;
        ResourceIntervalRestriction cpu_fraction = 2;
        ResourceIntervalRestriction memory = 3;
        ResourceIntervalRestriction gpu = 4;
        ResourceIntervalRestriction disk_size = 5;
        ResourceIntervalRestriction network_interfaces = 6;
        repeated string service_account_roles = 7;
        repeated ComputePlatform compute_platforms = 9;
    }

    message ResourceIntervalRestriction {
        int64 min = 1;
        int64 max = 2;
        int64 recommended = 3;
    }

    enum ComputePlatform {
        COMPUTE_PLATFORM_UNSPECIFIED = 0;
        STANDARD_V1 = 1;
        STANDARD_V2 = 2;
        GPU_STANDARD_V1 = 3;
    }

    message PackageInfo {
        OperationSystem os = 1;
        repeated PackageContentItem package_contents = 2;
    }

    message OperationSystem {
        OperationSystemFamily family = 1;
        string name = 2;
        string version = 3;
    }

    enum OperationSystemFamily {
        OPERATION_SYSTEM_FAMILY_UNSPECIFIED = 0;
        LINUX = 1;
        WINDOWS = 2;
        BSD = 3;
    }

    message PackageContentItem {
        string name = 1;
        string version = 2;
    }
}

message ComputeImageSource {
    string image_id = 1;
    string folder_id = 2;
}

message SaasPayload {

}

message SaasSource {

}

enum DatalensDeployType {
    DATALENS_DEPLOY_TYPE_UNSPECIFIED = 0;
    TEMPLATE = 1;
    CONNECTOR = 2;
}

enum DatalensVariableKind {
    DATALENS_VARIABLE_KIND_UNSPECIFIED = 0;
    SELECTOR = 1;
    SCROLL = 2;
}

message DatalensPropertiesValue {
    string value = 1;
    string title = 2;
}

message DatalensSelectorProperties {
    repeated DatalensPropertiesValue values = 1;
    string default_value = 2;
}

message DatalensScrollProperties {
    double min = 1;
    double max = 2;
    double step = 3;
    double default_value = 4;
}

message DatalensVariable {
    string name = 1;
    DatalensVariableKind kind = 2;
    string title = 3;
    oneof properties {
        DatalensSelectorProperties selector = 10;
        DatalensScrollProperties scroll = 11;
    }
}

message DatalensSubProduct {
    map<string, google.protobuf.Any> variables = 1;
    string sub_product_id = 2;
    string connector_name = 3;
    string template_name = 4;
}


message DatalensGeolayerPayload {
    repeated DatalensSubProduct sub_products = 1;
    repeated DatalensVariable variables = 2;
    DatalensDeployType deploy_type = 3;
}

message DatalensDatasetPayload {
    repeated DatalensSubProduct sub_products = 1;
    repeated DatalensVariable variables = 2;
    DatalensDeployType deploy_type = 3;
}

message DatalensConnectorPayload {
    repeated DatalensSubProduct sub_products = 1;
    repeated DatalensVariable variables = 2;
    DatalensDeployType deploy_type = 3;
}

message DatalensTemplatePayload {
    repeated DatalensSubProduct sub_products = 1;
    repeated DatalensVariable variables = 2;
    DatalensDeployType deploy_type = 3;
}

message DatalensGeolayerSource {
}

message DatalensDatasetSource {
}

message DatalensConnectorSource {
}

message DatalensTemplateSource {
}
