syntax = "proto3";

package yandex.cloud.priv.infra.opsmanager.v1;

import "google/api/annotations.proto";
import "yandex/cloud/priv/operation/operation.proto";
import "yandex/cloud/priv/validation.proto";

option go_package = "a.yandex-team.ru/cloud/bitbucket/private-api/yandex/cloud/priv/infra/opsmanager/v1;opsmanager";

service OperationService {

  // List returns the exists operations in order from new to old
  rpc List (ListOperationsRequest) returns (ListOperationsResponse) {
    option (google.api.http) = {get: "/api/operations"};
  }

  // Get returns the specified operation
  rpc Get (GetOperationRequest) returns (operation.Operation) {
    option (google.api.http) = {get: "/api/operations/{operation_id}"};
  }

  // Cancel changes the status of the specified operation to "CANCELLED"
  rpc Cancel (CancelOperationRequest) returns (operation.Operation) {
    option (google.api.http) = {post: "/api/operations/{operation_id}/cancel"};
  }

}

message GetOperationRequest {
  string operation_id = 1 [(required) = true, (length) = "<=64"];
}

message CancelOperationRequest {
  string operation_id = 1 [(required) = true, (length) = "<=64"];
}

message ListOperationsRequest {
  int64 page_size = 1 [(value) = "0-1001"];
  string page_token = 2 [(length) = "<=64"];
  repeated string operation_ids = 3 [(unique) = true, (size) = "<=10"];
  repeated string hosts = 4 [(unique) = true, (size) = "<=10"];
  repeated string workers = 5 [(unique) = true, (size) = "<=10"];
  repeated string ticket_ids = 6 [(unique) = true, (size) = "<=10"];
  repeated string created_by = 7 [(unique) = true, (size) = "<=10"];
  repeated string cancelled_by = 8 [(unique) = true, (size) = "<=10"];
}

message ListOperationsResponse {
  repeated operation.Operation operations = 1;
  string next_page_token = 2;
}

message OperationMetadata {
  string host = 1;
  string ticket_id = 2;
  string worker = 3;
  string last_step = 4;
  string cancelled_by = 5;
  string start_step = 6;
  string end_step = 7;
}

message VirtualResource {}
