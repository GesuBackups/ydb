import "google/protobuf/descriptor.proto";

package NKiwi.NMeta;

option java_package = "ru.yandex.kiwi.proto";

//////////////////////////////////////////
//// Language for defining statements ////
//////////////////////////////////////////

message TEntityFieldOptions {
    optional bool ReadOnly = 6;       // Such fields are filled by List* and are not used by other statements
    optional bool SemiSystem = 8;     // Field value can be set by user or (if value is not provided) some custom logic should generate a value
                                      // WARNING: it affects idempotency checking in Add*
    optional bool System = 9;         // Not accessible using metaquery
}

extend google.protobuf.FieldOptions {
    optional TEntityFieldOptions FieldOpts = 54301;
}

// Message that should be included into all entities, field name should be 'Meta'
message TEntityMeta {
    optional string Owner = 10 [(FieldOpts) = { SemiSystem: true }];
    repeated string Permissions = 20 [(FieldOpts) = { SemiSystem: true }];
    repeated string StrictPermissions = 30 [(FieldOpts) = { SemiSystem: true }];
    optional string Group = 40 [(FieldOpts) = { SemiSystem: true }];
    // must be in markdown format; first line must start with ##
    optional string Description = 100 [(FieldOpts) = { SemiSystem: true }];
    repeated string Category = 110 [(FieldOpts) = { SemiSystem: true }];
    optional fixed32 CrtTime = 200 [(FieldOpts) = { ReadOnly: true }];
    optional fixed32 ModTime = 210 [(FieldOpts) = { ReadOnly: true }];
    optional uint64 CrtTxId = 220 [(FieldOpts) = { ReadOnly: true }];
    optional uint64 ModTxId = 230 [(FieldOpts) = { ReadOnly: true }];
}

// Message that should be included into all Add* statements, field name should be 'Meta'
message TAddEntityMeta {
    optional string Owner = 10;
    repeated string Permissions = 20;
    repeated string StrictPermissions = 30;
    optional string Group = 40;
    optional string Description = 100;
    optional string DescriptionFile = 101;
    repeated string Category = 110;
    optional fixed32 CrtTime = 200;
    optional fixed32 ModTime = 210;
    optional uint64 CrtTxId = 220;
    optional uint64 ModTxId = 230;
}

// Message that should be included into all Change* statements, field name should be 'Meta'
message TChangeEntityMeta {
    optional string Owner = 10;
    optional bool ClearOwner = 11;
    optional bool ClearPermissions = 20;
    repeated string AppendPermissions = 21;
    repeated string PrependPermissions = 22;
    repeated string RemovePermissions = 23;
    optional bool ClearStrictPermissions = 30;
    repeated string AppendStrictPermissions = 31;
    repeated string PrependStrictPermissions = 32;
    repeated string RemoveStrictPermissions = 33;
    optional string Group = 40;
    optional bool ClearGroup = 41;
    optional string Description = 100;
    optional string DescriptionFile = 101;
    optional bool ClearDescription = 102;
    optional bool ClearCategory = 110;
    repeated string AddCategory = 111;
    repeated string RemoveCategory = 112;
    optional fixed32 CrtTime = 200;
    optional fixed32 ModTime = 210;
    optional uint64 CrtTxId = 220;
    optional uint64 ModTxId = 230;
}

// Message that should be included into all List* statements, field name should be 'Meta'
message TListEntityMeta {
    optional string Owner = 10;
    repeated string Permissions = 20;
    repeated string ExistPermissions = 21;
    repeated string StrictPermissions = 30;
    repeated string ExistStrictPermissions = 31;
    optional string Group = 40;
    optional string Description = 100;
    optional string DescriptionFile = 101;
    repeated string Category = 110;
    repeated string ExistCategory = 111;
    optional fixed32 CrtTime = 200;
    optional fixed32 ModTime = 210;
    optional uint64 CrtTxId = 220;
    optional uint64 ModTxId = 230;
}
